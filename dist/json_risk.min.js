/*! json_risk 14-02-2019 */

!function(e,t){"object"==typeof module&&"undefined"!=typeof exports?module.exports=t():e.JsonRisk=t()}(this,function(){var e={valuation_date:null,pricer:function(e,t){return null}};return e}),function(e){e.get_const_curve=function(e){if("number"!=typeof e)throw new Error("get_const_curve: input must be number.");if(e<=-1)throw new Error("get_const_curve: invalid input.");return{type:"yield",times:[1],dfs:[1/(1+e)]}},e.get_initialised_curve=function(t){if(!t)return e.get_const_curve(0);var r,i=function(t){var r,i;if(void 0===t.times){if(void 0!==t.days)for(r=t.days.length,i=new Array(r);r>0;)i[--r]=t.days[r]/365;else if(void 0!==t.dates){r=t.dates.length,i=new Array(r);for(var a=e.year_fraction_factory("act/365"),n=e.date_str_to_date(t.dates[0]);r>0;)i[--r]=a(n,e.date_str_to_date(t.dates[r]))}else{if(void 0===t.labels)throw new Error("init_curve: invalid curve, cannot derive times");for(r=t.labels.length,i=new Array(r);r>0;)i[--r]=e.period_str_to_time(t.labels[r])}return i}for(r=t.times.length;r>0;)if(r--,"number"!=typeof t.times[r])throw new Error("get_curve_times: invalid vector of times, must be numeric");return t.times}(t);if(void 0!==t.dfs)r=t.dfs;else{if(void 0===t.zcs)throw new Error("get_initialised_curve: invalid curve, both dfs and zcs undefined");r=function(e,t){var r,i;if(r=e.length,t.length!==r)throw new Error("get_dfs: invalid input, length of zcs does not match length of times");for(i=new Array(r);r>0;){if("number"!=typeof e[--r])throw new Error("get_curve_times: invalid vector of times, must be numeric");i[r]=Math.pow(1+e[r],-t[r])}return i}(t.zcs,i)}return{type:"yield",times:i,dfs:r}},get_df_internal=function(e,t,r,i){if(t<1/512)return 1;if(r===i)return t===e.times[r]?e.dfs[r]:Math.pow(e.dfs[r],t/e.times[r]);if(t<e.times[r])return Math.pow(e.dfs[r],t/e.times[r]);if(t>e.times[i])return Math.pow(e.dfs[i],t/e.times[i]);if(r+1===i){if(e.times[i]-e.times[r]<1/512)throw new Error("get_df_internal: invalid curve, support points must be increasing and differ at least one day");return e.dfs[r]*(e.times[i]-t)/(e.times[i]-e.times[r])+e.dfs[i]*(t-e.times[r])/(e.times[i]-e.times[r])}return imed=Math.ceil((r+i)/2),t>e.times[imed]?get_df_internal(e,t,imed,i):get_df_internal(e,t,r,imed)},e.get_df=function(t,r){var i=e.get_initialised_curve(t);return get_df_internal(i,r,0,i.times.length-1)},e.get_rate=function(t,r){return r<1/512?0:Math.pow(e.get_df(t,r),-1/r)-1},e.get_fwd_rate=function(t,r,i){if(i-r<1/512)return 0;var a=e.get_initialised_curve(t);return Math.pow(e.get_df(a,i)/e.get_df(a,r),-1/(i-r))-1}}(this.JsonRisk||module.exports),function(e){e.irregular_fixed_income=function(t){var r=e.get_initialised_date(t.maturity);if(!r)throw new Error("irregular_fixed_income: must provide maturity date.");if("number"!=typeof t.notional)throw new Error("irregular_fixed_income: must provide valid notional.");if(this.notional=t.notional,"number"!=typeof t.tenor)throw new Error("irregular_fixed_income: must provide valid tenor.");if(t.tenor<0||t.tenor!==Math.floor(t.tenor))throw new Error("irregular_fixed_income: must provide valid tenor.");var i=t.tenor;this.type="string"==typeof t.type?t.type:"unknown",this.is_holiday_func=e.is_holiday_factory(t.calendar||""),this.year_fraction_func=e.year_fraction_factory(t.dcc||""),this.bdc=t.bdc||"";var a=e.get_initialised_date(t.effective_date),n=e.get_initialised_date(t.first_date),o=e.get_initialised_date(t.next_to_last_date),s="number"==typeof t.settlement_days?t.settlement_days:0;this.settlement_date=e.adjust(e.add_days(e.valuation_date,s),"following",this.is_holiday_func);"number"==typeof t.residual_spread&&t.residual_spread,t.currency;if("number"==typeof t.fixed_rate)this.is_float=!1,this.fixed_rate=t.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof t.float_spread?t.float_spread:0,"number"!=typeof t.current_rate)throw new Error("irregular_fixed_income: must provide valid current_rate.");this.current_rate=t.current_rate}this.schedule=e.backward_schedule(a,r,i,this.is_holiday_func,this.bdc,n,o),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},e.irregular_fixed_income.prototype.fix_cash_flows=function(t,r,i,a,n,o){if(null===e.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var s,_,l=new Array(t.length-1),u=new Array(t.length-1),d=new Array(t.length-1),f=new Array(t.length-1),c=new Array(t.length-1),h=new Array(t.length-1),p=new Array(t.length-1),m=new Array(t.length-1),w=new Array(t.length-1),g=new Array(t.length-1),v=new Array(t.length-1),y=new Array(t.length-1),x=new Array(t.length-1),b=new Array(t.length-1),E=new Array(t.length-1),A=new Array(t.length-1),M=e.year_fraction_factory(null);for(s=0;s<t.length-1;s++)l[s]=t[s],u[s]=t[s+1],d[s]=(_=t[s+1],e.adjust(_,r,i)),h[s]=M(e.valuation_date,t[s+1]),p[s]=!0,m[s]=!1,w[s]=!1,g[s]=!1,v[s]=n,y[s]=n*o*a(l[s],u[s]),x[s]=y[s],b[s]=0,E[s]=y[s],A[s]=E[s];return A[t.length-2]+=n,b[t.length-2]+=n,m[t.length-2]=!0,{date_accrual_start:l,date_accrual_end:u,date_pmt:d,t_accrual_start:f,t_accrual_end:c,t_pmt:h,is_interest_date:p,is_repay_date:m,is_fixing_date:w,is_condition_date:g,current_principal:v,interest_current_period:y,accrued_interest:x,pmt_principal:b,pmt_interest:E,pmt_total:A}},e.irregular_fixed_income.prototype.get_cash_flows=function(t){if(!this.is_float)return this.cash_flows;var r,i,a,n=this.cash_flows,o=e.year_fraction_factory(null),s=n.t_pmt.length;for(r=1;r<s;r++)n.is_fixing_date[r]=!0,i=e.get_fwd_rate(t,o(e.valuation_date,n.date_accrual_start[r]),o(e.valuation_date,n.date_accrual_end[r]))+this.float_spread,a=this.notional*i*this.year_fraction_func(n.date_accrual_start[r],n.date_accrual_end[r]),n.interest_current_period[r]=a,n.accrued_interest[r]=a,n.pmt_interest[r]=a;return n.pmt_total[s-1]=n.pmt_interest[s-1]+this.notional,n},e.irregular_fixed_income.prototype.present_value=function(t,r,i){return e.dcf(this.get_cash_flows(i||null),t,r,this.residual_spread,this.settlement_date)},e.pricer_loan=function(t,r,i,a){return new e.irregular_fixed_income(t).present_value(r,i,a)}}(this.JsonRisk||module.exports),function(e){var t=Math.sqrt(4*Math.acos(0));e.ndf=function(e){return Math.exp(-e*e/2)/t},e.cndf=function(e){var r,i=Math.abs(e);if(i<=37){var a=Math.exp(-i*i/2);if(i<7.07106781186547)r=a*((((((.0352624965998911*i+.700383064443688)*i+6.37396220353165)*i+33.912866078383)*i+112.079291497871)*i+221.213596169931)*i+220.206867912376)/(((((((.0883883476483184*i+1.75566716318264)*i+16.064177579207)*i+86.7807322029461)*i+296.564248779674)*i+637.333633378831)*i+793.826512519948)*i+440.413735824752);else r=a/(t*(i+1/(i+2/(i+3/(i+4/(i+.65))))))}else r=0;return e<=0?r:1-r}}(this.JsonRisk||module.exports),function(e){e.backward_schedule=function(t,r,i,a,n,o,s){if(!(r instanceof Date))throw new Error("backward_schedule: maturity must be provided");if(!(t instanceof Date)){if(null===e.valuation_date)throw new Error("backward_schedule: if valuation_date is unset, effective date must be provided");if(o instanceof Date)throw new Error("backward_schedule: if first date is provided, effective date must be provided")}if(t instanceof Date&&r<t||e.valuation_date instanceof Date&&r<e.valuation_date)throw new Error("backward_schedule: maturity is before valution or effective date.");if("number"!=typeof i)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(i<0||Math.floor(i)!==i)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(0===i)return[t,r];var _=function(t){return e.adjust(t,n,a)},l=[r],u=r;s instanceof Date&&_(s)<_(r)&&(l.unshift(s),u=s);for(var d,f=0;;){if(f++,d=e.add_months(u,-i*f),o instanceof Date&&d<o)return _(l[0]).getTime()!==_(o).getTime()&&l.unshift(o),_(l[0]).getTime()!==_(t).getTime()&&l.unshift(t),l;if(t instanceof Date&&d<t)return _(l[0]).getTime()!==_(t).getTime()&&l.unshift(t),l;if(e.valuation_date instanceof Date&&d<e.valuation_date)return l.unshift(d),_(d)>e.valuation_date&&(f++,d=e.add_months(u,-i*f),o instanceof Date&&d<o?l.unshift(o):t instanceof Date&&d<t?l.unshift(t):l.unshift(d)),l;l.unshift(d)}}}(this.JsonRisk||module.exports),function(e){e.dcf=function(t,r,i,a,n){if(null===e.valuation_date)throw new Error("dcf: valuation_date must be set");var o=e.get_initialised_curve(r),s=e.get_initialised_curve(i);"number"!=typeof a&&(a=0);var _=e.get_initialised_date(n);if(_||(_=e.valuation_date),void 0===t.t_pmt||void 0===t.pmt_total)throw new Error("dcf: invalid cashflow object");if(t.t_pmt.length!==t.pmt_total.length)throw new Error("dcf: invalid cashflow object");for(var l,u,d,f=0,c=0;t.date_pmt[c]<=_;)c++;for(;c<t.t_pmt.length;)l=e.get_df(o,t.t_pmt[c]),u=e.get_df(s,t.t_pmt[c]),d=Math.pow(1+a,-t.t_pmt[c]),f+=t.pmt_total[c]*l*u*d,c++;return f},e.irr=function(t,r,i){if(null===e.valuation_date)throw new Error("irr: valuation_date must be set");void 0===i&&(i=0);for(var a=e.year_fraction_factory(null)(e.valuation_date,r),n=0,o=1e-4,s=0,_=20,l=0,u=1;Math.abs(u)>1e-9&&Math.abs(u-l)>1e-9&&_>0;)l=e.dcf(t,null,null,n,r)+i*Math.pow(1+n,-a),s=o,o-=(u=e.dcf(t,null,null,o,r)+i*Math.pow(1+o,-a))*(o-n)/(u-l),n=s,_--;if(0===_)throw new Error("irr: failed, too many iterations");return o},e.simple_fixed_income=function(t){var r=e.get_initialised_date(t.maturity);if(!r)throw new Error("simple_fixed_income: must provide maturity date.");if("number"!=typeof t.notional)throw new Error("simple_fixed_income: must provide valid notional.");if(this.notional=t.notional,"number"!=typeof t.tenor)throw new Error("simple_fixed_income: must provide valid tenor.");if(t.tenor<0||t.tenor!==Math.floor(t.tenor))throw new Error("simple_fixed_income: must provide valid tenor.");var i=t.tenor;this.type="string"==typeof t.type?t.type:"unknown",this.is_holiday_func=e.is_holiday_factory(t.calendar||""),this.year_fraction_func=e.year_fraction_factory(t.dcc||""),this.bdc=t.bdc||"";var a=e.get_initialised_date(t.effective_date),n=e.get_initialised_date(t.first_date),o=e.get_initialised_date(t.next_to_last_date),s="number"==typeof t.settlement_days?t.settlement_days:0;this.settlement_date=e.adjust(e.add_days(e.valuation_date,s),"following",this.is_holiday_func);"number"==typeof t.residual_spread&&t.residual_spread,t.currency;if("number"==typeof t.fixed_rate)this.is_float=!1,this.fixed_rate=t.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof t.float_spread?t.float_spread:0,"number"!=typeof t.current_rate)throw new Error("simple_fixed_income: must provide valid current_rate.");this.current_rate=t.current_rate}this.schedule=e.backward_schedule(a,r,i,this.is_holiday_func,this.bdc,n,o),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},e.simple_fixed_income.prototype.fix_cash_flows=function(t,r,i,a,n,o){if(null===e.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var s,_,l=new Array(t.length-1),u=new Array(t.length-1),d=new Array(t.length-1),f=new Array(t.length-1),c=new Array(t.length-1),h=new Array(t.length-1),p=new Array(t.length-1),m=new Array(t.length-1),w=new Array(t.length-1),g=new Array(t.length-1),v=new Array(t.length-1),y=new Array(t.length-1),x=new Array(t.length-1),b=new Array(t.length-1),E=new Array(t.length-1),A=new Array(t.length-1),M=e.year_fraction_factory(null);for(s=0;s<t.length-1;s++)l[s]=t[s],u[s]=t[s+1],d[s]=(_=t[s+1],e.adjust(_,r,i)),h[s]=M(e.valuation_date,d[s]),f[s]=M(e.valuation_date,t[s]),c[s]=M(e.valuation_date,t[s+1]),p[s]=!0,m[s]=!1,w[s]=!1,g[s]=!1,v[s]=n,y[s]=n*o*a(l[s],u[s]),x[s]=y[s],b[s]=0,E[s]=y[s],A[s]=E[s];return A[t.length-2]+=n,b[t.length-2]+=n,m[t.length-2]=!0,{date_accrual_start:l,date_accrual_end:u,date_pmt:d,t_accrual_start:f,t_accrual_end:c,t_pmt:h,is_interest_date:p,is_repay_date:m,is_fixing_date:w,is_condition_date:g,current_principal:v,interest_current_period:y,accrued_interest:x,pmt_principal:b,pmt_interest:E,pmt_total:A}},e.simple_fixed_income.prototype.get_cash_flows=function(t){if(!this.is_float)return this.cash_flows;var r,i,a,n=this.cash_flows,o=e.year_fraction_factory(null),s=n.t_pmt.length;for(r=0;r<s;r++)n.is_fixing_date[r]=!0,i=n.date_accrual_start[r]<e.valuation_date?this.current_rate:e.get_fwd_rate(t,o(e.valuation_date,n.date_accrual_start[r]),o(e.valuation_date,n.date_accrual_end[r]))+this.float_spread,a=this.notional*i*this.year_fraction_func(n.date_accrual_start[r],n.date_accrual_end[r]),n.interest_current_period[r]=a,n.accrued_interest[r]=a,n.pmt_interest[r]=a;return n.pmt_total[s-1]=n.pmt_interest[s-1]+this.notional,n},e.simple_fixed_income.prototype.present_value=function(t,r,i){return e.dcf(this.get_cash_flows(i||null),t,r,this.residual_spread,this.settlement_date)},e.pricer_bond=function(t,r,i){return new e.simple_fixed_income(t).present_value(r,i,null)},e.pricer_floater=function(t,r,i,a){return new e.simple_fixed_income(t).present_value(r,i,a)},e.pricer_swap=function(t,r,i){var a=t.is_payer?-1:1,n=new e.simple_fixed_income({notional:t.notional*a,maturity:t.maturity,fixed_rate:t.fixed_rate,tenor:t.fixed_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc}),o=new e.simple_fixed_income({notional:-t.notional*a,maturity:t.maturity,float_spread:t.float_spread,tenor:t.float_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.float_bdc,dcc:t.float_dcc,current_rate:t.float_current_rate});return n.present_value(r,null,null)+o.present_value(r,null,i)},e.pricer_fxterm=function(t,r){var i=new e.simple_fixed_income({notional:t.notional,maturity:t.maturity,fixed_rate:0,tenor:0}).present_value(r,null,null);return"number"!=typeof t.notional_2?i:i+new e.simple_fixed_income({notional:t.notional_2,maturity:t.maturity_2,fixed_rate:0,tenor:0}).present_value(r,null,null)}}(this.JsonRisk||module.exports),function(e){function t(t){var r,i;for(r=surface.labels_expiry.length,i=new Array(r);r>0;)i[--r]=e.period_str_to_time(t[r]);return i}e.get_const_surface=function(e,t){if("number"!=typeof e)throw new Error("get_const_surface: input must be number.");return{type:t||"",expiries:[1],terms:[1],values:[[e]]}},e.get_safe_surface=function(r){var i,a;if(!r)return e.get_const_surface(0);if(r.expiries)i=r.expiries;else{if(!r.labels_expiry)throw new Error("get_initialised_surface: cannot derive expiries");i=t(labels_expiry)}if(r.terms)a=r.terms;else{if(!r.labels_term)throw new Error("get_initialised_surface: cannot derive terms");a=t(labels_term)}if(r.values.length!==i.length)throw new Error("get_initialised_surface: expiries dimensions do not match values array");for(var n=0;n<i.length;n++)if(r.values[n].length!==a.length)throw new Error("get_initialised_surface: terms dimensions do not match values array");return{type:r.type||"",expiries:i,terms:a,values:r.values}},get_slice_rate_unsafe=function(e,t,r,i,a){i=i||0,a=a||e.terms.length-1;var n=e.values[t];return i===a?n[i]:r<e.terms[i]?n[i]:r>e.terms[a]?n[a]:i+1===a?n[i]*(e.terms[a]-r)/(e.terms[a]-e.terms[i])+n[a]*(r-e.terms[i])/(e.terms[a]-e.terms[i]):(imed=Math.ceil((i+a)/2),r>e.terms[imed]?get_slice_rate_unsafe(e,t,r,imed,a):get_slice_rate_unsafe(e,t,r,i,imed))},get_surface_rate_unsafe=function(e,t,r,i,a){return(i=i||0)===(a=a||e.expiries.length-1)?get_slice_rate_unsafe(e,i,r):t<e.expiries[i]?get_slice_rate_unsafe(e,i,r):t>e.expiries[a]?get_slice_rate_unsafe(e,a,r):i+1===a?get_slice_rate_unsafe(e,i,r)*(e.expiries[a]-t)/(e.expiries[a]-e.expiries[i])+get_slice_rate_unsafe(e,a,r)*(t-e.expiries[i])/(e.expiries[a]-e.expiries[i]):(imed=Math.ceil((i+a)/2),t>e.expiries[imed]?get_surface_rate_unsafe(e,t,r,imed,a):get_surface_rate_unsafe(e,t,r,i,imed))},e.get_surface_rate=function(t,r,i){var a=e.get_safe_surface(t);return get_surface_rate_unsafe(a,r,i)}}(this.JsonRisk||module.exports),function(e){e.swaption=function(t){if(this.phi=t.is_payer?-1:1,this.sign=t.is_short?-1:1,this.maturity=e.get_initialised_date(t.maturity),!this.maturity)throw new Error("swaption: must provide valid maturity date.");if(this.fixed_rate=t.fixed_rate,this.swap_fixed_leg_1bp=new e.simple_fixed_income({notional:t.notional,maturity:t.maturity,fixed_rate:1e-4,tenor:t.fixed_tenor,effective_date:t.expiry,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc}),this.swap_float_leg=new e.simple_fixed_income({notional:-t.notional,maturity:t.maturity,float_spread:t.float_spread,tenor:t.float_tenor,effective_date:t.expiry,calendar:t.calendar,bdc:t.float_bdc,dcc:t.float_dcc,current_rate:t.float_current_rate}),this.expiry=e.get_initialised_date(t.expiry),!this.expiry)throw new Error("swaption: must provide valid expiry date.")},e.swaption.prototype.present_value=function(t,r,i){if(null===e.valuation_date)throw new Error("swaption.present_value: valuation_date must be set");var a=e.year_fraction_factory(null),n=a(e.valuation_date,this.maturity),o=a(e.valuation_date,this.expiry),s=n-o;if(s<1/512)return 0;var _,l=e.get_df(t,n)*this.swap_fixed_leg_1bp.notional,u=this.swap_float_leg.present_value(t,null,r)+l,d=(this.swap_fixed_leg_1bp.present_value(t,null,null)-l)/1e-4,f=-u/d,c=e.get_surface_rate(i,o,s)*Math.sqrt(o);if(o<1/512||c<1e-4)_=Math.max(this.phi*(this.fixed_rate-f),0);else{var h=(this.fixed_rate-f)/c;_=this.phi*(this.fixed_rate-f)*e.cndf(this.phi*h)+c*e.ndf(h)}return _*=d,_*=this.sign},e.pricer_swaption=function(t,r,i,a){return new e.swaption(t).present_value(r,i,a)},e.create_equivalent_regular_swaption=function(t,r,i){if(void 0===t.date_pmt||void 0===t.pmt_total||void 0===t.current_principal)throw new Error("create_equivalent_regular_swaption: invalid cashflow object");if(t.t_pmt.length!==t.pmt_total.length||t.t_pmt.length!==t.current_principal.length)throw new Error("create_equivalent_regular_swaption: invalid cashflow object");if(null===e.valuation_date)throw new Error("create_equivalent_swaption: valuation_date must be set");i||(i={});var a,n=i.tenor||6,o=i.bdc||"unadjusted",s=i.calendar||"",_=0;for(a=0;a<t.current_principal.length;a++)t.date_pmt[a]<=r&&(_=t.current_principal[a]);if(0===_)throw new Error("create_equivalent_regular_swaption: invalid cashflow object or expiry, zero outstanding principal");var l=e.irr(t,r,-_);l=12/n*(Math.pow(1+l,n/12)-1);for(var u=e.get_const_curve(l+1e-4),d=e.get_const_curve(l-1e-4),f=e.dcf(t,u,null,null,r),c=e.dcf(t,d,null,null,r),h=1e4*(c-f)/(c+f),p=function(t){var r=new e.simple_fixed_income(t);return f=r.present_value(u),1e4*((c=r.present_value(d))-f)/(c+f)},m=Math.abs(l)<1e-8?h:-Math.log(1-h*l)/l,w=e.add_days(e.valuation_date,Math.round(365*m)),g={maturity:w,effective_date:r,settlement_date:r,notional:_,fixed_rate:l,tenor:n,calendar:s,bdc:o,dcc:"act/365"},v=p(g),y=20;Math.abs(v-h)>1/512&&y>0;)m=m*h/v,w=e.add_days(e.valuation_date,Math.round(365*m)),g.maturity=w,v=p(g),y--;return{is_payer:!1,maturity:w,expiry:r,notional:_,fixed_rate:l,fixed_tenor:n,float_spread:0,float_tenor:6,float_current_rate:0,calendar:s,fixed_bdc:o,float_bdc:o,fixed_dcc:"act/365",float_dcc:"act/365"}}}(this.JsonRisk||module.exports),function(e){var t=1/864e5;function r(e){return e%4==0&&(2e3===e||e%100!=0)}function i(e,t){return 1===t?r(e)?29:28:3===t||5===t||8===t||10===t?30:31}function a(e,r){return Math.round((r-e)*t)}function n(e,t){return a(e,t)/365}function o(e,t){return a(e,t)/360}function s(e,t){return(360*(t.getFullYear()-e.getFullYear())+30*(t.getMonth()-e.getMonth())+(Math.min(t.getDate(),30)-Math.min(e.getDate(),30)))/360}function _(e,t){if(e-t==0)return 0;if(e>t)return-_(t,e);var i=e.getFullYear(),n=t.getFullYear();if(i===n)return a(t,e)/(r(i)?366:365);var o=n-i-1;return o+=a(e,new Date(i+1,0,1))/(r(i)?366:365),o+=a(new Date(n,0,1),t)/(r(n)?366:365)}function l(e){return wd=e.getDay(),0===wd||6===wd}function u(t){if(l(t))return!0;var r=t.getDate(),i=t.getMonth();if(1===r&&0===i)return!0;if(25===r&&11===i)return!0;var a=t.getFullYear();if((1998===a||1999===a||2001===a)&&31===r&&11===i)return!0;if(a>2e3){if(1===r&&4===i||26===r&&11===i)return!0;var n=function(e){var t=Math.floor,r=t(e/100),i=e-19*t(e/19),a=t((r-17)/25),n=r-t(r/4)-t((r-a)/3)+19*i+15;n-=30*t(n/30),n-=t(n/28)*(1-t(n/28)*t(29/(n+1))*t((21-i)/11));var o=e+t(e/4)+n+2-r+t(r/4),s=n-(o-=7*t(o/7)),_=3+t((s+40)/44),l=s+28-31*t(_/4);return new Date(e,_-1,l)}(a);if(t.getTime()===e.add_days(n,-2).getTime())return!0;if(t.getTime()===e.add_days(n,1).getTime())return!0}return!1}e.period_str_to_time=function(e){var t=parseInt(e,10),r=e.charAt(e.length-1);if("Y"===r||"y"===r)return t;if("M"===r||"m"===r)return t/12;if("W"===r||"w"===r)return t/52;if("D"===r||"d"===r)return t/365;throw new Error("period_str_to_time(str) - Invalid time period string: "+e)},e.date_str_to_date=function(e){var t,r,a,n=null;if(null!==(n=/^([1-2][0-9]{3})[\/-]([0-9]{1,2})[\/-]([0-9]{1,2})/.exec(e))?(a=parseInt(n[1],10),r=parseInt(n[2],10)-1,t=parseInt(n[3],10)):null!==(n=/^([0-9]{1,2})\.([0-9]{1,2})\.([1-2][0-9]{3})/.exec(e))&&(a=parseInt(n[3],10),r=parseInt(n[2],10)-1,t=parseInt(n[1],10)),null===n)throw new Error("date_str_to_time(str) - Invalid date string: "+e);if(r<0||r>11)throw new Error("date_str_to_time(str) - Invalid month in date string: "+e);if(t<0||t>i(a,r))throw new Error("date_str_to_time(str) - Invalid day in date string: "+e);return new Date(a,r,t)},e.get_initialised_date=function(t){if(!t)return null;if(t instanceof Date)return t;if(t instanceof String||"string"==typeof t)return e.date_str_to_date(t);throw new Error("get_initialised_date: invalid input.")},e.year_fraction_factory=function(e){if(!(e instanceof String)&&"string"!=typeof e)return n;var t=e.toLowerCase();if("a"===t.charAt(0)){if("actual/365"===t||"act/365"===t||"a/365"===t||"act/365 (fixed)"===t||"actual/365 (fixed)"===t)return n;if("act/360"===t||"a/360"===t)return o;if("act/act"===t||"a/a"===t)return _}return"3"===t.charAt(0)&&"30e/360"===t?s:n},e.add_days=function(e,t){var r=new Date(e.valueOf());return r.setDate(r.getDate()+t),r},e.add_months=function(e,t,r){for(y=e.getFullYear(),m=e.getMonth()+t;m>=12;)m-=12,y+=1;for(;m<0;)m+=12,y-=1;return d=void 0===r?e.getDate():r,new Date(y,m,Math.min(d,i(y,m)))};var f={};e.add_calendar=function(r,i){if(!(r instanceof String||"string"==typeof r))throw new Error("add_calendar: invalid input.");if(!Array.isArray(i))throw new Error("add_calendar: invalid input.");var a,n,o,s=i.length,_=[];for(a=0;a<s;a++)(o=e.get_initialised_date(i[a]))&&(l(o)||_.push(o));for(s=_.length,a=1;a<41&&!((n=a*a-a+41)>=s/10);)a++;var u=new Array(n);for(a=0;a<n;a++)u[a]=[];for(a=0;a<s;a++)u[Math.floor(_[a].getTime()*t)%n].push(_[a].getTime());return f[r.toLowerCase()]=u,n},e.is_holiday_factory=function(e){var r=e.toLowerCase();if("target"===r)return u;if(Array.isArray(f[r])){var i=f[r];return function(e){if(l(e))return!0;for(var r=e.getTime(),a=Math.floor(r*t)%i.length,n=0;n<i[a].length;n++)if(r===i[a][n])return!0;return!1}}return l},e.adjust=function(t,r,i){var a,n=(r||"u").charAt(0).toLowerCase(),o=new Date(t);if("u"===n)return o;if("m"===n&&(a=o.getMonth()),"m"===n||"f"===n)for(;i(o);)o=e.add_days(o,1);if("f"===n)return o;if("m"===n&&a===o.getMonth())return o;for("m"===n&&(o=e.add_days(o,-1));i(o);)o=e.add_days(o,-1);return o}}(this.JsonRisk||module.exports);