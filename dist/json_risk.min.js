/*! json_risk 22-05-2019 */

!function(t,e){"object"==typeof module&&"undefined"!=typeof exports?module.exports=e():t.JsonRisk=e()}(this,function(){var t={valuation_date:null,require_vd:function(){if(!(t.valuation_date instanceof Date))throw new Error("JsonRisk: valuation_date must be set")}};return t}),function(t){t.callable_fixed_income=function(e){if("number"!=typeof e.fixed_rate)throw new Error("callable_fixed_income: must provide valid fixed_rate.");var r=t.get_safe_date(e.first_call_date);if(null===r)throw new Error("callable_fixed_income: must provide first call date");this.base=new t.simple_fixed_income(e),this.call_schedule=t.backward_schedule(r,t.get_safe_date(e.maturity),e.call_tenor||0,this.base.is_holiday_func,this.base.bdc),this.call_schedule.pop(),this.basket=new Array(this.call_schedule.length);for(var a=0;a<this.call_schedule.length;a++)this.basket[a]=new t.swaption({is_payer:!1,maturity:e.maturity,expiry:this.call_schedule[a],notional:e.notional,fixed_rate:e.fixed_rate,tenor:12,float_spread:0,float_tenor:6,float_current_rate:0,calendar:"TARGET",bdc:"u",float_bdc:"u",dcc:"act/365",float_dcc:"act/365"})},t.callable_fixed_income.prototype.present_value=function(e,r,a,i){var n,s=0;t.require_vd();var _,o=[];for(n=0;n<this.call_schedule.length;n++)(_=t.time_from_now(this.call_schedule[n]))>1/512&&o.push(_);var l=t.lgm_calibrate(this.basket,e,a,i);if(1===l.length)s=-t.lgm_european_call_on_cf(this.base.get_cash_flows(),o[0],e,l[0],r);else if(1<l.length){var u;for(n=0;n<l.length;n++)(u=-t.lgm_european_call_on_cf(this.base.get_cash_flows(),o[n],e,l[n],r))<s&&(s=u)}return s+=this.base.present_value(e,r,null)},t.pricer_callable_bond=function(e,r,a,i,n){return new t.callable_fixed_income(e).present_value(r,a,i,n)}}(this.JsonRisk||module.exports),function(t){var e=null;function r(r,a){if(!r.times){if(r.days)return r.days[a]/365;if(r.dates)return(e=e||t.year_fraction_factory("a/365"))(t.get_safe_date(r.dates[0]),t.get_safe_date(r.dates[a]));if(r.labels)return t.period_str_to_time(r.labels[a]);throw new Error("get_time_at: invalid curve, cannot derive times")}return r.times[a]}function a(t,e){if(t.dfs)return t.dfs[e];if(t.zcs)return Math.pow(1+t.zcs[e],-r(t,e));throw new Error("get_df: invalid curve, must provide dfs or zcs")}t.get_const_curve=function(t){if("number"!=typeof t)throw new Error("get_const_curve: input must be number.");if(t<=-1)throw new Error("get_const_curve: invalid input.");return{type:"yield",times:[1],dfs:[1/(1+t)]}},t.get_curve_times=function(t){var e=(t.times||t.days||t.dates||t.labels||[]).length;if(!e)throw new Error("get_curve_times: invalid curve, need to provide valid times, days, dates, or labels");for(var a=new Array(e);e>0;)a[--e]=r(t,e);return a},t.get_safe_curve=function(e){return e?{type:"yield",times:t.get_curve_times(e),dfs:function(t){var e=(t.times||t.days||t.dates||t.labels||[]).length;if(!e)throw new Error("get_curve_dfs: invalid curve, need to provide valid times, days, dates, or labels");if(t.dfs){if(t.dfs.length!==e)throw new Error("get_curve_dfs: invalid curve, dfs length must match times length")}else if(t.zcs.length!==e)throw new Error("get_curve_dfs: invalid curve, zcs length must match times length");for(var r=new Array(e);e>0;)if(r[--e]=t.dfs?t.dfs[e]:a(t,e),"number"!=typeof r[e])throw new Error("get_curve_dfs: invalid curve, must provide numeric zcs or dfs");return r}(e)}:t.get_const_curve(0)},t.get_df=function(e,i,n,s){if(void 0===n&&(n=0),void 0===s&&(s=(e.times||e.days||e.dates||e.labels).length-1),i<1/512)return 1;if(n===s)return i===r(e,n)?a(e,n):Math.pow(a(e,n),i/r(e,n));if(i<r(e,n))return Math.pow(a(e,n),i/r(e,n));if(i>r(e,s))return Math.pow(a(e,s),i/r(e,s));if(n+1===s){if(r(e,s)-r(e,n)<1/512)throw new Error("get_df_internal: invalid curve, support points must be increasing and differ at least one day");return a(e,n)*(r(e,s)-i)/(r(e,s)-r(e,n))+a(e,s)*(i-r(e,n))/(r(e,s)-r(e,n))}return imed=Math.ceil((n+s)/2),i>r(e,imed)?t.get_df(e,i,imed,s):t.get_df(e,i,n,imed)},t.get_rate=function(e,r){return r<1/512?0:Math.pow(t.get_df(e,r),-1/r)-1},t.get_fwd_rate=function(e,r,a){return a-r<1/512?0:Math.pow(t.get_df(e,a)/t.get_df(e,r),-1/(a-r))-1}}(this.JsonRisk||module.exports),function(t){t.fxterm=function(e){this.near_leg=new t.simple_fixed_income({notional:e.notional,maturity:e.maturity,fixed_rate:0,tenor:0}),"number"==typeof e.notional_2&&t.get_safe_date(e.maturity_2)?this.far_leg=new t.simple_fixed_income({notional:e.notional_2,maturity:e.maturity_2,fixed_rate:0,tenor:0}):this.far_leg=null},t.fxterm.prototype.present_value=function(t){var e=0;return e+=this.near_leg.present_value(t,null,null),this.far_leg&&(e+=this.far_leg.present_value(t,null,null)),e},t.pricer_fxterm=function(e,r){return new t.fxterm(e).present_value(r)}}(this.JsonRisk||module.exports),function(t){t.irregular_fixed_income=function(e,r){var a=t.get_safe_date(e.maturity);if(!a)throw new Error("irregular_fixed_income: must provide maturity date.");if("number"!=typeof e.notional)throw new Error("irregular_fixed_income: must provide valid notional.");if(this.notional=e.notional,"number"!=typeof e.tenor)throw new Error("irregular_fixed_income: must provide valid tenor.");if(e.tenor<0||e.tenor!==Math.floor(e.tenor))throw new Error("irregular_fixed_income: must provide valid tenor.");if(this.tenor=e.tenor,e.repay_tenor<0||e.repay_tenor!==Math.floor(e.repay_tenor))throw new Error("irregular_fixed_income: must provide valid repay_tenor.");this.repay_tenor=e.repay_tenor,this.repay_amount=e.repay_amount,this.current_accrued_interest=e.current_accrued_interest,this.amortization=e.amortization,this.current_accrued_interest=e.current_accrued_interest,this.type="string"==typeof e.type?e.type:"unknown",this.is_holiday_func=t.is_holiday_factory(e.calendar||""),this.year_fraction_func=t.year_fraction_factory(e.dcc||""),this.bdc=e.bdc||"";var i=t.get_safe_date(e.effective_date),n=t.get_safe_date(e.first_date),s=t.get_safe_date(e.next_to_last_date),_=t.get_safe_date(e.repay_first_date),o=t.get_safe_date(e.repay_next_to_last_date);if(null!=e.conditions_valid_until){this.conditions_valid_until=new Array(e.conditions_valid_until.length-1);for(var l=0;l<this.conditions_valid_until.length;l++)this.conditions_valid_until[l]=t.get_safe_date(e.conditions_valid_until[l])}var u="number"==typeof e.settlement_days?e.settlement_days:0;this.settlement_date=t.adjust(t.add_days(t.valuation_date,u),"following",this.is_holiday_func);"number"==typeof e.residual_spread&&e.residual_spread,e.currency;if(null!=e.fixed_rate)this.is_float=!1,this.fixed_rate=e.fixed_rate;else{if(this.is_float=!0,this.float_spread=e.float_spread?e.float_spread:0,"number"!=typeof e.current_rate)throw new Error("irregular_fixed_income: must provide valid current_rate.");this.current_rate=e.current_rate,this.cap_rate=e.cap_rate,this.floor_rate=e.floor_rate,this.fixing_tenor=e.fixing_tenor,this.fixing_first_date=t.get_safe_date(e.fixing_first_date),this.fixing_next_to_last_date=t.get_safe_date(e.fixing_next_to_last_date)}this.schedule=t.backward_schedule(i,a,this.tenor,this.is_holiday_func,this.bdc,n,s),1==this.is_float&&(this.fixing_schedule=t.backward_schedule(this.fixing_first_date,this.fixing_next_to_last_date,this.fixing_tenor,this.is_holiday_func,this.bdc,this.fixing_first_date,this.fixing_next_to_last_date)),this.repay_schedule=t.backward_schedule(i,a,this.repay_tenor,this.is_holiday_func,this.bdc,_,o),this.merged_schedule=this.get_merged_schedule(),1==this.is_float?this.cash_flows=this.fixflt_cash_flows(this.current_rate,r):this.cash_flows=this.fixflt_cash_flows(this.fixed_rate,null)},t.irregular_fixed_income.prototype.update_flt_cash_flows=function(t){return this.cash_flows=this.fixflt_cash_flows(this.current_rate,t),this.cash_flows},t.irregular_fixed_income.prototype.fixflt_cash_flows=function(e,r){if(null===t.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");t.year_fraction_factory(null);var a=this.merged_schedule.date_accrual_start.length,i=new Array(a),n=new Array(a),s=new Array(a),_=new Array(a),o=new Array(a),l=new Array(a);this.actual_rate="number"==typeof e?e:e[0],this.actual_notional=this.notional,this.actual_int_accrual=this.current_accrued_interest,this.actual_payment="number"==typeof this.repay_amount?this.repay_ampount:this.repay_amount[0],this.actual_amortization="number"==typeof this.amortization?this.amortization:this.amortization[0],1==this.is_float&&(this.float_rate_series=this.get_fwd_rate_series(r),this.rate_pos=0,null!=this.float_spread&&(this.actual_float_spread="number"==typeof this.float_spread?this.float_speard:this.float_spread[0]),null!=this.cap_rate&&(this.actual_cap_rate="number"==typeof this.cap_rate?this.cap_rate:this.cap_rate[0]),null!=this.floor_rate&&(this.actual_floor_rate="number"==typeof this.floor_rate?this.floor_rate:this.floor_rate[0]));for(var u=0,c=0;c<a;c++)1==this.merged_schedule.is_condition_date[c]&&(u++,this.actual_amortization=this.amortization[u],this.actual_payment=this.repay_amount[u]),cf_step=this.cf_step(c),i[c]=cf_step.current_principal,n[c]=cf_step.interest_current_period,s[c]=cf_step.accrued_interest,_[c]=cf_step.pmt_principal,o[c]=cf_step.pmt_interest,l[c]=cf_step.pmt_principal+cf_step.pmt_interest,1==this.merged_schedule.is_condition_date&&(this.actual_amortization=this.amortization[u],this.actual_rate=e[u]?e[u]:this.actual_rate,this.actual_payment=this.repay_amount[u]),1==this.is_float&&(1==this.merged_schedule.is_fixing_date[c]&&(this.actual_rate=this.float_rate_series[this.rate_pos],this.rate_pos<this.float_rate_series.length-1&&this.rate_pos++),1==this.merged_schedule.is_condition_date[c]&&(this.actual_float_spread=this.float_spread[u],this.actual_cap_rate=this.cap_rate[u],this.actual_floor_rate=this.floor_rate[u]),isNaN(this.actual_floor_rate)&&isNaN(this.actual_cap_rate)?this.actual_rate+=this.actual_float_spread||0:isNaN(this.actual_floor_rate)&&"number"==typeof this.actuial_cap_rate?this.actual_rate=Math.max(this.actual_rate,this.actual_cap_rate-(this.actual_float_spread||0))+(this.actual_float_spread||0):isNaN(this.actual_cap_rate)&&"number"==typeof this.actual_floor_rate?this.actual_rate=Math.min(this.actual_rate,this.actual_floor_rate-(this.actual_float_spread||0))+(this.actual_float_spread||0):this.actual_rate=Math.min(Math.max(this.actual_rate,this.actual_floor_rate-(this.actual_float_spread||0)),this.actual_cap_rate-(this.actual_float_spread||0))+(this.actual_spread_spread||0));return l[a-1]+=this.actual_notional,_[a-1]+=this.actual_notional,{date_accrual_start:this.merged_schedule.date_accrual_start,date_accrual_end:this.merged_schedule.date_accrual_end,date_pmt:this.merged_schedule.date_pmt,t_accrual_start:this.merged_schedule.t_accrual_start,t_accrual_end:this.merged_schedule.t_accrual_end,t_pmt:this.merged_schedule.t_pmt,is_interest_date:this.merged_schedule.is_interest_date,is_repay_date:this.merged_schedule.is_repay_date,is_fixing_date:this.merged_schedule.is_fixing_date,is_condition_date:this.merged_schedule.is_condition_date,current_principal:i,interest_current_period:n,accrued_interest:s,pmt_principal:_,pmt_interest:o,pmt_total:l}},t.irregular_fixed_income.prototype.get_merged_schedule=function(){this.fixing_tenor,this.tenor;for(var e=[],r=0;r<this.schedule.length;r++)e.push([this.schedule[r],0]);for(var a=0;a<this.repay_schedule.length;a++)e.push([this.repay_schedule[a],1]);if(null!=this.conditions_valid_until&&this.conditions_valid_until.length>=1)for(var n=0;n<this.conditions_valid_until.length;n++)e.push([this.conditions_valid_until[n],.5,n]);e.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0});for(var s=0;s<e.length-1;s++)for(;e[s+1]&&Math.abs(e[s][0]-e[s+1][0])<1e3;)2==e[s].length&&2==e[s+1].length?(e[s]=[e[s][0],2],e.splice(s+1,1)):3==e[s+1].length?(e[s]=[e[s][0],e[s][1],e[s+1][2]],e.splice(s+1,1)):3==e[s].length&&(e[s]=[e[s+1][0],e[s+1][1],e[s][2]],e.splice(s+1,1));if(null===t.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var _=e.length-1,o=t.year_fraction_factory(null),l=new Array(_),u=new Array(_),c=new Array(_),d=new Array(_),f=new Array(_),h=new Array(_),p=new Array(_),m=new Array(_),g=new Array(_),v=new Array(_),w=0;for(i=0;i<_;i++)l[i]=e[i][0],u[i]=e[i+1][0],c[i]=e[i+1][1]<=0||1==e[i+1][1]||e[i+1][1]>=2?this.adj(e[i+1][0]):null,d[i]=o(t.valuation_date,e[i][0]),f[i]=o(t.valuation_date,e[i+1][0]),h[i]=null!=c[i]?o(t.valuation_date,c[i]):null,p[i]=e[i+1][1]<=0||e[i+1][1]>=2,m[i]=1==e[i+1][1]||e[i+1][1]>=2,g[i]=!1,v[i]=3==e[i+1].length,1==this.is_float&&1==p[i]&&u[i]-this.fixing_schedule[w]>-1e3&&(g[i]=!0,w++,console.log("index next fixing= "+w));return{date_accrual_start:l,date_accrual_end:u,date_pmt:c,t_accrual_start:d,t_accrual_end:f,t_pmt:h,is_interest_date:p,is_repay_date:m,is_fixing_date:g,is_condition_date:v}},t.irregular_fixed_income.prototype.adj=function(e){return t.adjust(e,this.bdc,this.is_holiday_func)},t.irregular_fixed_income.prototype.get_fwd_rate_series=function(e){for(var r=t.year_fraction_factory(null),a=[],i=0;i<this.fixing_schedule.length-1;i++)this.fixing_schedule[i]-t.valuation_date>1e3&&a.push(t.get_fwd_rate(e,r(t.valuation_date,this.fixing_schedule[i]),r(t.valuation_date,this.fixing_schedule[i+1])));return a},t.irregular_fixed_income.prototype.cf_step=function(t){var e,r,a,i,n,s=0;switch(a=this.actual_notional*this.year_fraction_func(this.merged_schedule.date_accrual_start[t],this.merged_schedule.date_accrual_end[t])*this.actual_rate,r=this.actual_int_accrual+a,this.actual_amortization){case"bullet":e=this.actual_notional,n=1==this.merged_schedule.is_interest_date[t]?r+this.actual_int_accrual:0,this.actual_int_accrual=1==this.merged_schedule.is_condition_date&&0==this.merged_schedule.is_interest_date?r:0,i=0;break;case"capitalization":e=1==this.merged_schedule.is_condition_date[t]&&0==this.merged_schedule.is_interest_date[t]?this.actual_notional:Math.max(this.actual_notional+r,0),this.actual_int_accrual=0==this.merged_schedule.is_interest_date[t]?r:0,n=0,i=0;break;case"stepdown":e=1==this.merged_schedule.is_repay_date[t]?Math.max(this.actual_notional-this.actual_payment,0):this.actual_notional,i=1==this.merged_schedule.is_repay_date[t]?Math.min(this.actual_payment,this.actual_notional):0,n=1==this.merged_schedule.is_interest_date[t]?r:0,this.actual_int_accrual=0==this.merged_schedule.is_interest_date[t]?r:0;break;case"annuity":e=1==this.merged_schedule.is_repay_date[t]&&0==this.merged_schedule.is_interest_date[t]?Math.max(this.actual_notional-this.actual_payment,0):1==this.merged_schedule.is_repay_date[t]&&1==this.merged_schedule.is_interest_date[t]?Math.max(this.actual_notional+r-this.actual_payment,0):0==this.merged_schedule.is_repay_date[t]&&1==this.merged_schedule.is_interest_date[t]?Math.max(this.actual_notional+r,0):this.actual_notional,s=1==this.merged_schedule.is_repay_date[t]?Math.min(this.actual_payment,this.actual_notional+r):0,this.actual_int_accrual=0==this.merged_schedule.is_interest_date[t]?r:0,i=s,n=0;break;default:throw new Error("invalid amortization type parameter.")}return this.actual_notional=e,{current_principal:"deposit"==this.type?-this.actual_notional:this.actual_notional,interest_current_period:"deposit"==this.type?-a:a,accrued_interest:"deposit"==this.type?-this.actual_int_accrual:this.actual_int_accrual,pmt_principal:"deposit"==this.type?-i:i,pmt_interest:"deposit"==this.type?-n:n}},t.irregular_fixed_income.prototype.present_value=function(e,r,a){return t.dcf(this.get_cash_flows(a||null),e,r,this.residual_spread,this.settlement_date)},t.pricer_loan=function(e,r,a,i){return new t.irregular_fixed_income(e).present_value(r,a,i)}}(this.JsonRisk||module.exports),function(t){function e(t){return t}t.lgm_dcf=function(r,a,i,n,s,_,o){if(!Array.isArray(s))throw new Error("lgm_dcf: state variable must be an array of numbers");for(var l,u,c,d=0,f=new Array(s.length);r.t_pmt[d]<=a;)d++;var h=0;for(r.pmt_interest&&(h=0===d?0:r.pmt_interest[d]*(a-r.t_pmt[d-1])/(r.t_pmt[d]-r.t_pmt[d-1])),u=t.get_df(i,a),_&&(u*=t.get_df(_,a)),o&&(u*=Math.pow(1+o,-a)),l=0;l<s.length;l++)f[l]=-(r.current_principal[d]+h)*u;for(;d<r.t_pmt.length;){for(u=t.get_df(i,r.t_pmt[d]),_&&(u*=t.get_df(_,r.t_pmt[d])),o&&(u*=Math.pow(1+o,-r.t_pmt[d])),c=e(r.t_pmt[d])-e(a),l=0;l<s.length;l++)f[l]+=r.pmt_total[d]*u*Math.exp(-c*s[l]-c*c*n*.5);d++}return f},t.lgm_european_call_on_cf=function(r,a,i,n,s,_){if(a<0)return 0;if(a<1/512||n<1e-15)return t.lgm_dcf(r,a,i,0,[0],s,_)[0];function o(e){return t.lgm_dcf(r,a,i,n,[e],s,_)[0]}var l,u,c,d,f,h=Math.sqrt(n),p=1/h;if(u=e(r.t_pmt[r.t_pmt.length-1])-e(a),c=-.5*n*u-Math.log(t.get_df(i,a))/u+Math.log(t.get_df(i,r.t_pmt[r.t_pmt.length-1]))/u,Math.abs(c)<1e-10&&(c=-h),o(c)>0)for(f=c,d=.5*c;o(d)>0;)d=f-2*d;else for(d=c,f=2*c;o(d)<0;)f*=2;l=t.find_root_ridders(o,f,d,100);for(var m,g=0;r.t_pmt[g]<=a;)g++;var v=0;r.pmt_interest&&(v=0===g?0:r.pmt_interest[g]*(a-r.t_pmt[g-1])/(r.t_pmt[g]-r.t_pmt[g-1])),m=t.get_df(i,a);for(var w=-(r.current_principal[g]+v)*m*t.cndf(l*p);g<r.t_pmt.length;)m=t.get_df(i,r.t_pmt[g]),u=e(r.t_pmt[g])-e(a),w+=r.pmt_total[g]*m*t.cndf(l*p+u*h),g++;return w},t.lgm_european_swaption_adjusted_cashflow=function(t,e,r,a){var i,n=t.swap.fair_rate(e,e);if(a)i=n;else{var s=t.swap.fair_rate(e,r);i=t.swap.fixed_rate-s+n}for(var _=t.swap.fixed_leg_1bp.get_cash_flows(),o=new Array(_.pmt_total.length),l=new Array(_.pmt_interest.length),u=0;u<_.pmt_total.length;u++)l[u]=_.pmt_interest[u]*i*1e4,o[u]=l[u];return o[u-1]+=_.current_principal[u-1],{current_principal:_.current_principal,t_pmt:_.t_pmt,date_pmt:_.date_pmt,pmt_interest:l,pmt_total:o}},t.lgm_european_swaption=function(e,r,a,i,n){var s=t.lgm_european_swaption_adjusted_cashflow(e,a,n);return t.lgm_european_call_on_cf(s,r,a,i,null,null)},t.lgm_calibrate=function(r,a,i,n){t.require_vd();var s,_,o,l,u,c,d,f,h,p,m,g,v=[],w=function(e){return t.lgm_european_call_on_cf(_,l,a,e*e,null,null)-d};for(h=0;h<r.length;h++)if(t.time_from_now(r[h].expiry)>1/512){for(l=t.time_from_now(r[h].expiry),u=t.time_from_now(r[h].maturity),_=t.lgm_european_swaption_adjusted_cashflow(r[h],a,i,!1),c=0,p=0;p<_.t_pmt.length;p++)c+=_.pmt_total[p]*t.get_df(a,_.t_pmt[p])*(e(_.t_pmt[p])-e(l));o=t.get_surface_rate(n,l,u-l)*Math.sqrt(l),s=Math.pow(o*r[h].swap.annuity(a)/c,2),g=(m=t.lgm_dcf(_,l,a,0,[0],null,null)[0])+r[h].swap.fixed_leg.notional*t.get_df(a,l),m<0&&(m=0),(d=r[h].present_value(a,i,n))<m&&(d=m),d>g&&(d=g);try{s=(f=t.find_root_secant(w,Math.sqrt(s),Math.sqrt(.5*s),100))*f}catch(t){}v.length>0&&v[v.length-1]<s&&(s=v[v.length-1]),v.push(s)}return v};t.lgm_european_call_on_cf_numeric=function(e,r,a,i,n,s){if(r<1/512||i<1e-15)return t.lgm_dcf(e,r,a,0,[0],n,s)[0];var _,o=Math.sqrt(i),l=o/20,u=new Array(161);for(u[0]=-4*o,_=1;_<161;_++)u[_]=u[0]+_*l;var c=t.lgm_dcf(e,r,a,i,u),d=0;for(_=0;_<161;_++)c[_]>0&&(d+=c[_]*Math.exp(-.5*u[_]*u[_]/i));return d*=l,d/=Math.sqrt(2*Math.PI*i)}}(this.JsonRisk||module.exports),function(t){var e=Math.sqrt(4*Math.acos(0));t.ndf=function(t){return Math.exp(-t*t/2)/e},t.cndf=function(t){var r,a=Math.abs(t);if(a<=37){var i=Math.exp(-a*a/2);if(a<7.07106781186547)r=i*((((((.0352624965998911*a+.700383064443688)*a+6.37396220353165)*a+33.912866078383)*a+112.079291497871)*a+221.213596169931)*a+220.206867912376)/(((((((.0883883476483184*a+1.75566716318264)*a+16.064177579207)*a+86.7807322029461)*a+296.564248779674)*a+637.333633378831)*a+793.826512519948)*a+440.413735824752);else r=i/(e*(a+1/(a+2/(a+3/(a+4/(a+.65))))))}else{if(!(a>37))throw new Error("cndf: invalid input.");r=0}return t<=0?r:1-r},t.find_root_secant=function(t,e,r,a,i){var n=e,s=r,_=0,o=a||20,l=i||1e-8,u=t(n),c=t(s);for(Math.abs(c)>Math.abs(u)&&(_=n,n=s,s=_,_=u,u=c,c=_);Math.abs(c)>l&&o>0;){for(_=(n-s)*c/(c-u),u=c,c=t(s=(n=s)+_);Math.abs(c)>Math.abs(u)&&o>0;)c=t(s=n+(_=Math.abs(_)>1?Math.sqrt(Math.abs(_))*(_<0?-1:1):_/2)),o--;o--}if(o<=0)throw new Error("find_root_secant: failed, too many iterations");if(isNaN(s))throw new Error("find_root_secant: failed, invalid result");return s},t.find_root_ridders=function(t,e,r,a,i){var n,s,_,o=e,l=r,u=0,c=0,d=0,f=a||20,h=i||1e-8,p=t(o),m=t(l);if(p*m>0)throw new Error("find_root_ridders: start values do not bracket the root");if(Math.abs(p)<h)return o;if(Math.abs(m)<h)return l;for(;f>0;){if(f--,n=t(u=.5*(o+l)),Math.abs(n)<h)return u;if(0===(d=Math.sqrt(n*n-m*p)))return u;if(c=(u-o)*((_=p-m)>0?1:_<0?-1:0)*n/d+u,isNaN(c)&&(c=u),s=t(c),Math.abs(s)<h)return c;n*s<0?(o=c,p=s,l=u,m=n):p*s<0?(l=c,m=s):m*s<0&&(o=c,p=s)}if(f<=0)throw new Error("find_root_ridders: failed, too many iterations")}}(this.JsonRisk||module.exports),function(t){t.backward_schedule=function(e,r,a,i,n,s,_){if(!(r instanceof Date))throw new Error("backward_schedule: maturity must be provided");if(!(e instanceof Date)){if(null===t.valuation_date)throw new Error("backward_schedule: if valuation_date is unset, effective date must be provided");if(s instanceof Date)throw new Error("backward_schedule: if first date is provided, effective date must be provided")}if(e instanceof Date&&r<e||t.valuation_date instanceof Date&&r<t.valuation_date)throw new Error("backward_schedule: maturity is before valution or effective date.");if("number"!=typeof a)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(a<0||Math.floor(a)!==a)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(0===a)return[e instanceof Date?e:t.valuation_date,r];var o=function(e){return t.adjust(e,n,i)},l=[r],u=r;_ instanceof Date&&o(_)<o(r)&&(l.unshift(_),u=_);for(var c,d=0;;){if(d++,c=t.add_months(u,-a*d),s instanceof Date&&c<s)return o(l[0]).getTime()!==o(s).getTime()&&l.unshift(s),o(l[0]).getTime()!==o(e).getTime()&&l.unshift(e),l;if(e instanceof Date&&c<e)return o(l[0]).getTime()!==o(e).getTime()&&l.unshift(e),l;if(t.valuation_date instanceof Date&&c<t.valuation_date)return l.unshift(c),o(c)>t.valuation_date&&(d++,c=t.add_months(u,-a*d),s instanceof Date&&c<s?l.unshift(s):e instanceof Date&&c<e?l.unshift(e):l.unshift(c)),l;l.unshift(c)}}}(this.JsonRisk||module.exports),function(t){t.dcf=function(e,r,a,i,n){var s=r||t.get_safe_curve(null),_=a||t.get_safe_curve(null);t.require_vd(),"number"!=typeof i&&(i=0);var o=t.get_safe_date(n);if(o||(o=t.valuation_date),void 0===e.t_pmt||void 0===e.pmt_total)throw new Error("dcf: invalid cashflow object");if(e.t_pmt.length!==e.pmt_total.length)throw new Error("dcf: invalid cashflow object");for(var l,u,c,d=0,f=0;e.date_pmt[f]<=o;)f++;for(;f<e.t_pmt.length;)l=t.get_df(s,e.t_pmt[f]),u=t.get_df(_,e.t_pmt[f]),c=Math.pow(1+i,-e.t_pmt[f]),d+=e.pmt_total[f]*l*u*c,f++;return d},t.irr=function(e,r,a){t.require_vd(),a||(a=0);var i=t.time_from_now(r);return t.find_root_secant(function(n){return t.dcf(e,null,null,n,r)+a*Math.pow(1+n,-i)},0,1e-4)},t.simple_fixed_income=function(e,r){var a=t.get_safe_date(e.maturity);if(!a)throw new Error("simple_fixed_income: must provide maturity date.");if("number"!=typeof e.notional)throw new Error("simple_fixed_income: must provide valid notional.");if(this.notional=e.notional,this.include_notional_pmt=!1!==r,"number"!=typeof e.tenor)throw new Error("simple_fixed_income: must provide valid tenor.");if(e.tenor<0||e.tenor!==Math.floor(e.tenor))throw new Error("simple_fixed_income: must provide valid tenor.");var i=e.tenor;this.type="string"==typeof e.type?e.type:"unknown",this.is_holiday_func=t.is_holiday_factory(e.calendar||""),this.year_fraction_func=t.year_fraction_factory(e.dcc||""),this.bdc=e.bdc||"";var n=t.get_safe_date(e.effective_date),s=t.get_safe_date(e.first_date),_=t.get_safe_date(e.next_to_last_date),o="number"==typeof e.settlement_days?e.settlement_days:0;this.settlement_date=t.adjust(t.add_days(t.valuation_date,o),"following",this.is_holiday_func);"number"==typeof e.residual_spread&&e.residual_spread,e.currency;if("number"==typeof e.fixed_rate)this.is_float=!1,this.fixed_rate=e.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof e.float_spread?e.float_spread:0,"number"!=typeof e.float_current_rate)throw new Error("simple_fixed_income: must provide valid float_current_rate.");this.current_rate=e.float_current_rate}this.schedule=t.backward_schedule(n,a,i,this.is_holiday_func,this.bdc,s,_),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},t.simple_fixed_income.prototype.fix_cash_flows=function(e,r,a,i,n,s){t.require_vd();var _,o,l=new Array(e.length-1),u=new Array(e.length-1),c=new Array(e.length-1),d=new Array(e.length-1),f=new Array(e.length-1),h=new Array(e.length-1),p=new Array(e.length-1),m=new Array(e.length-1),g=new Array(e.length-1),v=new Array(e.length-1),w=new Array(e.length-1),y=new Array(e.length-1),x=new Array(e.length-1),b=new Array(e.length-1),M=new Array(e.length-1),A=new Array(e.length-1);for(_=0;_<e.length-1;_++)l[_]=e[_],u[_]=e[_+1],c[_]=(o=e[_+1],t.adjust(o,r,a)),h[_]=t.time_from_now(c[_]),d[_]=t.time_from_now(e[_]),f[_]=t.time_from_now(e[_+1]),p[_]=!0,m[_]=!1,g[_]=!1,v[_]=!1,w[_]=n,y[_]=n*s*i(l[_],u[_]),x[_]=y[_],b[_]=0,M[_]=y[_],A[_]=M[_];return this.include_notional_pmt&&(A[e.length-2]+=n,b[e.length-2]+=n),m[e.length-2]=!0,{date_accrual_start:l,date_accrual_end:u,date_pmt:c,t_accrual_start:d,t_accrual_end:f,t_pmt:h,is_interest_date:p,is_repay_date:m,is_fixing_date:g,is_condition_date:v,current_principal:w,interest_current_period:y,accrued_interest:x,pmt_principal:b,pmt_interest:M,pmt_total:A}},t.simple_fixed_income.prototype.get_cash_flows=function(e){if(!this.is_float)return this.cash_flows;var r,a,i,n=this.cash_flows,s=n.t_pmt.length;for(r=0;r<s;r++)n.is_fixing_date[r]=!0,a=n.date_accrual_start[r]<t.valuation_date?this.current_rate:t.get_fwd_rate(e,t.time_from_now(n.date_accrual_start[r]),t.time_from_now(n.date_accrual_end[r]))+this.float_spread,i=this.notional*a*this.year_fraction_func(n.date_accrual_start[r],n.date_accrual_end[r]),n.interest_current_period[r]=i,n.accrued_interest[r]=i,n.pmt_interest[r]=i,n.pmt_total[r]=i;return this.include_notional_pmt&&(n.pmt_total[s-1]=n.pmt_interest[s-1]+this.notional),n},t.simple_fixed_income.prototype.present_value=function(e,r,a){return t.dcf(this.get_cash_flows(t.get_safe_curve(a)||null),t.get_safe_curve(e),t.get_safe_curve(r),this.residual_spread,this.settlement_date)},t.pricer_bond=function(e,r,a){return new t.simple_fixed_income(e).present_value(r,a,null)},t.pricer_floater=function(e,r,a,i){return new t.simple_fixed_income(e).present_value(r,a,i)}}(this.JsonRisk||module.exports),function(t){function e(e,r){if(e.terms)return e.terms[r];if(e.labels_term)return t.period_str_to_time(e.labels_term[r]);throw new Error("get_term_at: invalid surface, cannot derive terms")}function r(e,r){if(e.expiries)return e.expiries[r];if(e.labels_expiry)return t.period_str_to_time(e.labels_expiry[r]);throw new Error("get_expiry_at: invalid surface, cannot derive expiries")}function a(t,r,i,n,s){n=n||0,s=s||(t.terms||t.labels_term||[]).length-1;var _=t.values[r];return n===s?_[n]:i<e(t,n)?_[n]:i>e(t,s)?_[s]:n+1===s?_[n]*(e(t,s)-i)/(e(t,s)-e(t,n))+_[s]*(i-e(t,n))/(e(t,s)-e(t,n)):(imed=Math.ceil((n+s)/2),i>e(t,imed)?a(t,r,i,imed,s):a(t,r,i,n,imed))}t.get_const_surface=function(t,e){if("number"!=typeof t)throw new Error("get_const_surface: input must be number.");return{type:e||"",expiries:[1],terms:[1],values:[[t]]}},t.get_safe_surface=function(a){return a?{type:a.type||"",expiries:function(t){var e=(t.expiries||t.labels_expiry||[]).length;if(!e)throw new Error("get_surface_terms: invalid surface, need to provide valid expiries or labels_expiry");for(var a=new Array(e);e>0;)a[--e]=r(t,e);return a}(a),terms:function(t){var r=(t.terms||t.labels_term||[]).length;if(!r)throw new Error("get_surface_terms: invalid surface, need to provide valid terms or labels_term");for(var a=new Array(r);r>0;)a[--r]=e(t,r);return a}(a),values:a.values}:t.get_const_surface(0)},t.get_surface_rate=function(e,i,n,s,_){return(s=s||0)===(_=_||(e.expiries||e.labels_expiry||[]).length-1)?a(e,s,n):i<r(e,s)?a(e,s,n):i>r(e,_)?a(e,_,n):s+1===_?a(e,s,n)*(r(e,_)-i)/(r(e,_)-r(e,s))+a(e,_,n)*(i-r(e,s))/(r(e,_)-r(e,s)):(imed=Math.ceil((s+_)/2),i>r(e,imed)?t.get_surface_rate(e,i,n,imed,_):t.get_surface_rate(e,i,n,s,imed))}}(this.JsonRisk||module.exports),function(t){t.swap=function(e){this.phi=e.is_payer?-1:1,this.fixed_rate=e.fixed_rate,this.fixed_leg=new t.simple_fixed_income({notional:e.notional*this.phi,maturity:e.maturity,fixed_rate:e.fixed_rate,tenor:e.tenor,effective_date:e.effective_date,calendar:e.calendar,bdc:e.bdc,dcc:e.dcc},!1),this.fixed_leg_1bp=new t.simple_fixed_income({notional:e.notional*this.phi,maturity:e.maturity,fixed_rate:1e-4,tenor:e.tenor,effective_date:e.effective_date,calendar:e.calendar,bdc:e.bdc,dcc:e.dcc},!1),this.float_leg=new t.simple_fixed_income({notional:-e.notional*this.phi,maturity:e.maturity,float_spread:e.float_spread,tenor:e.float_tenor,effective_date:e.effective_date,calendar:e.calendar,bdc:e.float_bdc,dcc:e.float_dcc,float_current_rate:e.float_current_rate},!1)},t.swap.prototype.fair_rate=function(t,e){var r=this.float_leg.present_value(t,null,e);return-this.phi*r/this.annuity(t)},t.swap.prototype.annuity=function(t){return this.fixed_leg_1bp.present_value(t)*this.phi*1e4},t.swap.prototype.present_value=function(t,e){var r=0;return r+=this.fixed_leg.present_value(t,null,null),r+=this.float_leg.present_value(t,null,e)},t.swap.prototype.get_cash_flows=function(t){return{fixed_leg:this.fixed_leg.get_cash_flows(),float_leg:this.float_leg.get_cash_flows(t)}},t.pricer_swap=function(e,r,a){return new t.swap(e).present_value(r,a)}}(this.JsonRisk||module.exports),function(t){t.swaption=function(e){if(this.sign=e.is_short?-1:1,this.maturity=t.get_safe_date(e.maturity),!this.maturity)throw new Error("swaption: must provide valid maturity date.");if(this.expiry=t.get_safe_date(e.expiry),!this.expiry)throw new Error("swaption: must provide valid expiry date.");this.swap=new t.swap({is_payer:e.is_payer,notional:e.notional,effective_date:this.expiry,settlement_date:this.expiry,maturity:e.maturity,fixed_rate:e.fixed_rate,tenor:e.tenor,calendar:e.calendar,bdc:e.bdc,dcc:e.dcc,float_spread:e.float_spread,float_tenor:e.float_tenor,float_bdc:e.float_bdc,float_dcc:e.float_dcc,float_current_rate:e.float_current_rate})},t.swaption.prototype.present_value=function(e,r,a){t.require_vd();var i=t.time_from_now(this.maturity),n=t.time_from_now(this.expiry),s=i-n;if(s<1/512)return 0;var _,o=this.swap.fair_rate(e,r),l=t.get_surface_rate(a,n,s)*Math.sqrt(n);if(n<0)return 0;if(n<1/512||l<1e-4)_=Math.max(this.swap.phi*(this.swap.fixed_rate-o),0);else{var u=(this.swap.fixed_rate-o)/l;_=this.swap.phi*(this.swap.fixed_rate-o)*t.cndf(this.swap.phi*u)+l*t.ndf(u)}return _*=this.swap.annuity(e),_*=this.sign},t.pricer_swaption=function(e,r,a,i){return new t.swaption(e).present_value(r,a,i)},t.create_equivalent_regular_swaption=function(e,r,a){if(void 0===e.date_pmt||void 0===e.pmt_total||void 0===e.current_principal)throw new Error("create_equivalent_regular_swaption: invalid cashflow object");if(e.t_pmt.length!==e.pmt_total.length||e.t_pmt.length!==e.current_principal.length)throw new Error("create_equivalent_regular_swaption: invalid cashflow object");t.require_vd(),a||(a={});for(var i,n=a.tenor||6,s=a.bdc||"unadjusted",_=a.calendar||"",o=0;e.date_pmt[o]<=r;)o++;if(0===(i=e.current_principal[o]))throw new Error("create_equivalent_regular_swaption: invalid cashflow object or expiry, zero outstanding principal");var l=t.irr(e,r,-i);l=12/n*(Math.pow(1+l,n/12)-1);for(var u=t.get_const_curve(l+1e-4),c=t.get_const_curve(l-1e-4),d=t.dcf(e,u,null,null,r),f=t.dcf(e,c,null,null,r),h=1e4*(f-d)/(f+d),p=function(e){var r=new t.simple_fixed_income(e);return d=r.present_value(u),1e4*((f=r.present_value(c))-d)/(f+d)},m=Math.abs(l)<1e-8?h:-Math.log(1-h*l)/l,g=t.add_days(t.valuation_date,Math.round(365*m)),v={maturity:g,effective_date:r,settlement_date:r,notional:i,fixed_rate:l,tenor:n,calendar:_,bdc:s,dcc:"act/365"},w=p(v),y=10;Math.abs(w-h)>1/512&&y>0;)m=m*h/w,g=t.add_days(t.valuation_date,Math.round(365*m)),v.maturity=g,w=p(v),y--;return{is_payer:!1,maturity:g,expiry:r,effective_date:r,settlement_date:r,notional:i,fixed_rate:l,tenor:n,float_spread:0,float_tenor:6,float_current_rate:0,calendar:_,bdc:s,float_bdc:s,dcc:"act/365",float_dcc:"act/365"}}}(this.JsonRisk||module.exports),function(t){var e=1/864e5;function r(t){return t%4==0&&(2e3===t||t%100!=0)}function a(t,e){return new Date(t,e+1,0).getDate()}function i(t,r){return Math.round((r-t)*e)}function n(t,e){return i(t,e)/365}function s(t,e){return i(t,e)/360}function _(t,e){return(360*(e.getFullYear()-t.getFullYear())+30*(e.getMonth()-t.getMonth())+(Math.min(e.getDate(),30)-Math.min(t.getDate(),30)))/360}function o(t,e){if(t-e==0)return 0;if(t>e)return-o(e,t);var a=t.getFullYear(),n=e.getFullYear();if(a===n)return i(t,e)/(r(a)?366:365);var s=n-a-1;return s+=i(t,new Date(a+1,0,1))/(r(a)?366:365),s+=i(new Date(n,0,1),e)/(r(n)?366:365)}function l(t){return wd=t.getDay(),0===wd||6===wd}function u(e){if(l(e))return!0;var r=e.getDate(),a=e.getMonth();if(1===r&&0===a)return!0;if(25===r&&11===a)return!0;var i=e.getFullYear();if((1998===i||1999===i||2001===i)&&31===r&&11===a)return!0;if(i>2e3){if(1===r&&4===a||26===r&&11===a)return!0;var n=function(t){var e=Math.floor,r=e(t/100),a=t-19*e(t/19),i=e((r-17)/25),n=r-e(r/4)-e((r-i)/3)+19*a+15;n-=30*e(n/30),n-=e(n/28)*(1-e(n/28)*e(29/(n+1))*e((21-a)/11));var s=t+e(t/4)+n+2-r+e(r/4),_=n-(s-=7*e(s/7)),o=3+e((_+40)/44),l=_+28-31*e(o/4);return new Date(t,o-1,l)}(i);if(e.getTime()===t.add_days(n,-2).getTime())return!0;if(e.getTime()===t.add_days(n,1).getTime())return!0}return!1}t.period_str_to_time=function(t){var e=parseInt(t,10),r=t.charAt(t.length-1);if("Y"===r||"y"===r)return e;if("M"===r||"m"===r)return e/12;if("W"===r||"w"===r)return e/52;if("D"===r||"d"===r)return e/365;throw new Error("period_str_to_time(str) - Invalid time period string: "+t)},t.date_str_to_date=function(t){var e,r,i,n=null;if(null!==(n=/^([1-2][0-9]{3})[\/-]([0-9]{1,2})[\/-]([0-9]{1,2})/.exec(t))?(i=parseInt(n[1],10),r=parseInt(n[2],10)-1,e=parseInt(n[3],10)):null!==(n=/^([0-9]{1,2})\.([0-9]{1,2})\.([1-2][0-9]{3})/.exec(t))&&(i=parseInt(n[3],10),r=parseInt(n[2],10)-1,e=parseInt(n[1],10)),null===n)throw new Error("date_str_to_time(str) - Invalid date string: "+t);if(r<0||r>11)throw new Error("date_str_to_time(str) - Invalid month in date string: "+t);if(e<0||e>a(i,r))throw new Error("date_str_to_time(str) - Invalid day in date string: "+t);return new Date(i,r,e)},t.get_safe_date=function(e){if(!e)return null;if(e instanceof Date)return e;if(e instanceof String||"string"==typeof e)return t.date_str_to_date(e);throw new Error("get_safe_date: invalid input.")},t.year_fraction_factory=function(t){if(!(t instanceof String)&&"string"!=typeof t)return n;var e=t.toLowerCase();if("a"===e.charAt(0)){if("actual/365"===e||"act/365"===e||"a/365"===e||"act/365 (fixed)"===e||"actual/365 (fixed)"===e)return n;if("act/360"===e||"a/360"===e)return s;if("act/act"===e||"a/a"===e)return o}return"3"===e.charAt(0)&&"30e/360"===e?_:n},t.time_from_now=function(e){return t.require_vd(),n(t.valuation_date,e)},t.add_days=function(t,e){var r=new Date(t.valueOf());return r.setDate(r.getDate()+e),r},t.add_months=function(t,e,r){for(y=t.getFullYear(),m=t.getMonth()+e;m>=12;)m-=12,y+=1;for(;m<0;)m+=12,y-=1;return d=void 0===r?t.getDate():r,new Date(y,m,Math.min(d,a(y,m)))};var c={};t.add_calendar=function(r,a){if(!(r instanceof String||"string"==typeof r))throw new Error("add_calendar: invalid input.");if(!Array.isArray(a))throw new Error("add_calendar: invalid input.");var i,n,s,_=a.length,o=[];for(i=0;i<_;i++)(s=t.get_safe_date(a[i]))&&(l(s)||o.push(s));for(_=o.length,i=1;i<41&&!((n=i*i-i+41)>=_/10);)i++;var u=new Array(n);for(i=0;i<n;i++)u[i]=[];for(i=0;i<_;i++)u[Math.floor(o[i].getTime()*e)%n].push(o[i].getTime());return c[r.toLowerCase()]=u,n},t.is_holiday_factory=function(t){var r=t.toLowerCase();if("target"===r)return u;if(Array.isArray(c[r])){var a=c[r];return function(t){if(l(t))return!0;for(var r=t.getTime(),i=Math.floor(r*e)%a.length,n=0;n<a[i].length;n++)if(r===a[i][n])return!0;return!1}}return l},t.adjust=function(e,r,a){var i,n=(r||"u").charAt(0).toLowerCase(),s=new Date(e);if("u"===n)return s;if("m"===n&&(i=s.getMonth()),"m"===n||"f"===n)for(;a(s);)s=t.add_days(s,1);if("f"===n)return s;if("m"===n&&i===s.getMonth())return s;for("m"===n&&(s=t.add_days(s,-1));a(s);)s=t.add_days(s,-1);return s}}(this.JsonRisk||module.exports),function(t){var e=null,r=function(t){if(1!==t)if(1!==e.vector_length){if(t!==e.vector_length)throw new Error("vector_pricing: parameters need to have the same length or length one")}else e.vector_length=t};t.store_params=function(a){var i,n,s,_,o,l,u,c;if((e={vector_length:1}).valuation_date=t.get_safe_date(a.valuation_date),"object"==typeof a.scalars)for(e.scalars={},i=Object.keys(a.scalars),n=0;n<i.length;n++)e.scalars[i[n]]=(s=a.scalars[i[n]],Array.isArray(s.value)?{value:s.value}:{value:[s.value]}),r(e.scalars[i[n]].value.length);if("object"==typeof a.curves)for(e.curves={},i=Object.keys(a.curves),n=0;n<i.length;n++)l=a.curves[i[n]],_={times:t.get_curve_times(l),dfs:l.dfs?Array.isArray(l.dfs[0])?l.dfs:[l.dfs]:null,zcs:l.zcs?Array.isArray(l.zcs[0])?l.zcs:[l.zcs]:null},e.curves[i[n]]=_,o=_.dfs?_.dfs.length:_.zcs.length,r(o);if("object"==typeof a.surfaces)for(e.surfaces={},i=Object.keys(a.surfaces),n=0;n<i.length;n++)e.surfaces[i[n]]=(u=a.surfaces[i[n]],void 0,{expiries:(c=t.get_safe_surface(u)).expiries,terms:c.terms,values:Array.isArray(u.values[0][0])?u.values:[u.values]}),r(e.surfaces[i[n]].values.length)},t.get_params=function(){return e};var a=function(t,e){return t?{times:t.times,dfs:t.dfs?t.dfs[t.dfs.length>1?e:0]:null,zcs:t.zcs?t.zcs[t.zcs.length>1?e:0]:null}:null};t.vector_pricer=function(r){if("string"!=typeof r.type)throw new Error("vector_pricer: instrument object must contain valid type");t.valuation_date=e.valuation_date;for(var i,n,s,_,o,l,u=function(e){switch(e.type.toLowerCase()){case"bond":case"floater":return new t.simple_fixed_income(e);case"swap":return new t.swap(e);case"swaption":return new t.swaption(e);case"fxterm":return new t.fxterm(e);case"callable_bond":return new t.callable_fixed_income(e);default:throw new Error("vector_pricer: invalid instrument type")}}(r),c=e.curves[r.disc_curve||""]||null,d=e.curves[r.spread_curve||""]||null,f=e.curves[r.fwd_curve||""]||null,h=e.surfaces[r.surface||""]||null,p=e.scalars[r.currency||""]||null,m=new Array(e.vector_length),g=0;g<e.vector_length;g++){switch(i=a(c,g),n=a(d,g),s=a(f,g),l=g,_=(o=h)?{expiries:o.expiries,terms:o.terms,values:o.values[o.values.length>1?l:0]}:null,r.type.toLowerCase()){case"bond":case"floater":case"fxterm":m[g]=u.present_value(i,n,s);break;case"swap":case"swaption":m[g]=u.present_value(i,s,_);break;case"callable_bond":m[g]=u.present_value(i,n,s,_)}p&&(m[g]/=p.value[p.value.length>1?g:0])}return m}}(this.JsonRisk||module.exports);