/*! json_risk 04-03-2019 */

!function(e,t){"object"==typeof module&&"undefined"!=typeof exports?module.exports=t():e.JsonRisk=t()}(this,function(){var e={valuation_date:null,pricer:function(e,t){return null}};return e}),function(e){e.get_const_curve=function(e){if("number"!=typeof e)throw new Error("get_const_curve: input must be number.");if(e<=-1)throw new Error("get_const_curve: invalid input.");return{type:"yield",times:[1],dfs:[1/(1+e)]}},e.get_safe_curve=function(t){if(!t)return e.get_const_curve(0);var r,a=function(t){var r,a;if(t.times){for(r=t.times.length;r>0;)if(r--,"number"!=typeof t.times[r])throw new Error("get_curve_times: invalid vector of times, must be numeric");return t.times}if(t.days)for(r=t.days.length,a=new Array(r);r>0;)a[--r]=t.days[r]/365;else if(t.dates){r=t.dates.length,a=new Array(r);for(var n=e.year_fraction_factory("act/365"),i=e.date_str_to_date(t.dates[0]);r>0;)a[--r]=n(i,e.date_str_to_date(t.dates[r]))}else{if(!t.labels)throw new Error("init_curve: invalid curve, cannot derive times");for(r=t.labels.length,a=new Array(r);r>0;)a[--r]=e.period_str_to_time(t.labels[r])}return a}(t);if(t.dfs)r=t.dfs;else{if(!t.zcs)throw new Error("get_safe_curve: invalid curve, both dfs and zcs undefined");r=function(e,t){var r,a;if(r=e.length,t.length!==r)throw new Error("get_dfs: invalid input, length of zcs does not match length of times");for(a=new Array(r);r>0;){if("number"!=typeof e[--r])throw new Error("get_curve_times: invalid vector of times, must be numeric");a[r]=Math.pow(1+e[r],-t[r])}return a}(t.zcs,a)}return{type:"yield",times:a,dfs:r}},e.get_df_unsafe=function(t,r,a,n){if(void 0===a&&(a=0),void 0===n&&(n=t.times.length-1),r<1/512)return 1;if(a===n)return r===t.times[a]?t.dfs[a]:Math.pow(t.dfs[a],r/t.times[a]);if(r<t.times[a])return Math.pow(t.dfs[a],r/t.times[a]);if(r>t.times[n])return Math.pow(t.dfs[n],r/t.times[n]);if(a+1===n){if(t.times[n]-t.times[a]<1/512)throw new Error("get_df_internal: invalid curve, support points must be increasing and differ at least one day");return t.dfs[a]*(t.times[n]-r)/(t.times[n]-t.times[a])+t.dfs[n]*(r-t.times[a])/(t.times[n]-t.times[a])}return imed=Math.ceil((a+n)/2),r>t.times[imed]?e.get_df_unsafe(t,r,imed,n):e.get_df_unsafe(t,r,a,imed)},e.get_rate_unsafe=function(t,r){return r<1/512?0:Math.pow(e.get_df_unsafe(t,r),-1/r)-1},e.get_fwd_rate_unsafe=function(t,r,a){return a-r<1/512?0:Math.pow(e.get_df_unsafe(t,a)/e.get_df_unsafe(t,r),-1/(a-r))-1},e.get_df=function(t,r){var a=e.get_safe_curve(t);return e.get_df_unsafe(a,r,0,a.times.length-1)},e.get_rate=function(t,r){if(r<1/512)return 0;var a=e.get_safe_curve(t);return e.get_rate_unsafe(a,r)},e.get_fwd_rate=function(t,r,a){if(a-r<1/512)return 0;var n=e.get_safe_curve(t);return e.get_fwd_rate_unsafe(n,r,a)}}(this.JsonRisk||module.exports),function(e){e.irregular_fixed_income=function(t){var r=e.get_initialised_date(t.maturity);if(!r)throw new Error("irregular_fixed_income: must provide maturity date.");if("number"!=typeof t.notional)throw new Error("irregular_fixed_income: must provide valid notional.");if(this.notional=t.notional,"number"!=typeof t.tenor)throw new Error("irregular_fixed_income: must provide valid tenor.");if(t.tenor<0||t.tenor!==Math.floor(t.tenor))throw new Error("irregular_fixed_income: must provide valid tenor.");var a=t.tenor;this.type="string"==typeof t.type?t.type:"unknown",this.is_holiday_func=e.is_holiday_factory(t.calendar||""),this.year_fraction_func=e.year_fraction_factory(t.dcc||""),this.bdc=t.bdc||"";var n=e.get_initialised_date(t.effective_date),i=e.get_initialised_date(t.first_date),o=e.get_initialised_date(t.next_to_last_date),s="number"==typeof t.settlement_days?t.settlement_days:0;this.settlement_date=e.adjust(e.add_days(e.valuation_date,s),"following",this.is_holiday_func);"number"==typeof t.residual_spread&&t.residual_spread,t.currency;if("number"==typeof t.fixed_rate)this.is_float=!1,this.fixed_rate=t.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof t.float_spread?t.float_spread:0,"number"!=typeof t.current_rate)throw new Error("irregular_fixed_income: must provide valid current_rate.");this.current_rate=t.current_rate}this.schedule=e.backward_schedule(n,r,a,this.is_holiday_func,this.bdc,i,o),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},e.irregular_fixed_income.prototype.fix_cash_flows=function(t,r,a,n,i,o){if(null===e.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var s,_,f=new Array(t.length-1),u=new Array(t.length-1),l=new Array(t.length-1),d=new Array(t.length-1),c=new Array(t.length-1),h=new Array(t.length-1),p=new Array(t.length-1),m=new Array(t.length-1),w=new Array(t.length-1),g=new Array(t.length-1),v=new Array(t.length-1),y=new Array(t.length-1),x=new Array(t.length-1),b=new Array(t.length-1),E=new Array(t.length-1),A=new Array(t.length-1),M=e.year_fraction_factory(null);for(s=0;s<t.length-1;s++)f[s]=t[s],u[s]=t[s+1],l[s]=(_=t[s+1],e.adjust(_,r,a)),h[s]=M(e.valuation_date,t[s+1]),p[s]=!0,m[s]=!1,w[s]=!1,g[s]=!1,v[s]=i,y[s]=i*o*n(f[s],u[s]),x[s]=y[s],b[s]=0,E[s]=y[s],A[s]=E[s];return A[t.length-2]+=i,b[t.length-2]+=i,m[t.length-2]=!0,{date_accrual_start:f,date_accrual_end:u,date_pmt:l,t_accrual_start:d,t_accrual_end:c,t_pmt:h,is_interest_date:p,is_repay_date:m,is_fixing_date:w,is_condition_date:g,current_principal:v,interest_current_period:y,accrued_interest:x,pmt_principal:b,pmt_interest:E,pmt_total:A}},e.irregular_fixed_income.prototype.get_cash_flows=function(t){if(!this.is_float)return this.cash_flows;var r,a,n,i=this.cash_flows,o=e.year_fraction_factory(null),s=i.t_pmt.length;for(r=1;r<s;r++)i.is_fixing_date[r]=!0,a=e.get_fwd_rate(t,o(e.valuation_date,i.date_accrual_start[r]),o(e.valuation_date,i.date_accrual_end[r]))+this.float_spread,n=this.notional*a*this.year_fraction_func(i.date_accrual_start[r],i.date_accrual_end[r]),i.interest_current_period[r]=n,i.accrued_interest[r]=n,i.pmt_interest[r]=n;return i.pmt_total[s-1]=i.pmt_interest[s-1]+this.notional,i},e.irregular_fixed_income.prototype.present_value=function(t,r,a){return e.dcf(this.get_cash_flows(a||null),t,r,this.residual_spread,this.settlement_date)},e.pricer_loan=function(t,r,a,n){return new e.irregular_fixed_income(t).present_value(r,a,n)}}(this.JsonRisk||module.exports),function(e){var t=Math.sqrt(4*Math.acos(0));e.ndf=function(e){return Math.exp(-e*e/2)/t},e.cndf=function(e){var r,a=Math.abs(e);if(a<=37){var n=Math.exp(-a*a/2);if(a<7.07106781186547)r=n*((((((.0352624965998911*a+.700383064443688)*a+6.37396220353165)*a+33.912866078383)*a+112.079291497871)*a+221.213596169931)*a+220.206867912376)/(((((((.0883883476483184*a+1.75566716318264)*a+16.064177579207)*a+86.7807322029461)*a+296.564248779674)*a+637.333633378831)*a+793.826512519948)*a+440.413735824752);else r=n/(t*(a+1/(a+2/(a+3/(a+4/(a+.65))))))}else r=0;return e<=0?r:1-r},e.find_root_secant=function(e,t,r,a,n){for(var i=t,o=r,s=0,_=a||20,f=n||1e-9,u=0,l=1;Math.abs(l)>f&&Math.abs(l-u)>f&&_>0;)u=e(i),s=o,o-=(l=e(o))*(o-i)/(l-u),i=s,_--;if(0===_)throw new Error("find_root_secant: failed, too many iterations");return o}}(this.JsonRisk||module.exports),function(e){e.backward_schedule=function(t,r,a,n,i,o,s){if(!(r instanceof Date))throw new Error("backward_schedule: maturity must be provided");if(!(t instanceof Date)){if(null===e.valuation_date)throw new Error("backward_schedule: if valuation_date is unset, effective date must be provided");if(o instanceof Date)throw new Error("backward_schedule: if first date is provided, effective date must be provided")}if(t instanceof Date&&r<t||e.valuation_date instanceof Date&&r<e.valuation_date)throw new Error("backward_schedule: maturity is before valution or effective date.");if("number"!=typeof a)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(a<0||Math.floor(a)!==a)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(0===a)return[t,r];var _=function(t){return e.adjust(t,i,n)},f=[r],u=r;s instanceof Date&&_(s)<_(r)&&(f.unshift(s),u=s);for(var l,d=0;;){if(d++,l=e.add_months(u,-a*d),o instanceof Date&&l<o)return _(f[0]).getTime()!==_(o).getTime()&&f.unshift(o),_(f[0]).getTime()!==_(t).getTime()&&f.unshift(t),f;if(t instanceof Date&&l<t)return _(f[0]).getTime()!==_(t).getTime()&&f.unshift(t),f;if(e.valuation_date instanceof Date&&l<e.valuation_date)return f.unshift(l),_(l)>e.valuation_date&&(d++,l=e.add_months(u,-a*d),o instanceof Date&&l<o?f.unshift(o):t instanceof Date&&l<t?f.unshift(t):f.unshift(l)),f;f.unshift(l)}}}(this.JsonRisk||module.exports),function(e){e.dcf=function(t,r,a,n,i){if(null===e.valuation_date)throw new Error("dcf: valuation_date must be set");var o=e.get_safe_curve(r),s=e.get_safe_curve(a);"number"!=typeof n&&(n=0);var _=e.get_safe_date(i);if(_||(_=e.valuation_date),void 0===t.t_pmt||void 0===t.pmt_total)throw new Error("dcf: invalid cashflow object");if(t.t_pmt.length!==t.pmt_total.length)throw new Error("dcf: invalid cashflow object");for(var f,u,l,d=0,c=0;t.date_pmt[c]<=_;)c++;for(;c<t.t_pmt.length;)f=e.get_df(o,t.t_pmt[c]),u=e.get_df(s,t.t_pmt[c]),l=Math.pow(1+n,-t.t_pmt[c]),d+=t.pmt_total[c]*f*u*l,c++;return d},e.irr=function(t,r,a){if(null===e.valuation_date)throw new Error("irr: valuation_date must be set");void 0===a&&(a=0);var n=e.year_fraction_factory(null)(e.valuation_date,r);return e.find_root_secant(function(i){return e.dcf(t,null,null,i,r)+a*Math.pow(1+i,-n)},0,1e-4)},e.simple_fixed_income=function(t,r){var a=e.get_safe_date(t.maturity);if(!a)throw new Error("simple_fixed_income: must provide maturity date.");if("number"!=typeof t.notional)throw new Error("simple_fixed_income: must provide valid notional.");if(this.notional=t.notional,this.include_notional_pmt=!1!==r,"number"!=typeof t.tenor)throw new Error("simple_fixed_income: must provide valid tenor.");if(t.tenor<0||t.tenor!==Math.floor(t.tenor))throw new Error("simple_fixed_income: must provide valid tenor.");var n=t.tenor;this.type="string"==typeof t.type?t.type:"unknown",this.is_holiday_func=e.is_holiday_factory(t.calendar||""),this.year_fraction_func=e.year_fraction_factory(t.dcc||""),this.bdc=t.bdc||"";var i=e.get_safe_date(t.effective_date),o=e.get_safe_date(t.first_date),s=e.get_safe_date(t.next_to_last_date),_="number"==typeof t.settlement_days?t.settlement_days:0;this.settlement_date=e.adjust(e.add_days(e.valuation_date,_),"following",this.is_holiday_func);"number"==typeof t.residual_spread&&t.residual_spread,t.currency;if("number"==typeof t.fixed_rate)this.is_float=!1,this.fixed_rate=t.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof t.float_spread?t.float_spread:0,"number"!=typeof t.current_rate)throw new Error("simple_fixed_income: must provide valid current_rate.");this.current_rate=t.current_rate}this.schedule=e.backward_schedule(i,a,n,this.is_holiday_func,this.bdc,o,s),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},e.simple_fixed_income.prototype.fix_cash_flows=function(t,r,a,n,i,o){if(null===e.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var s,_,f=new Array(t.length-1),u=new Array(t.length-1),l=new Array(t.length-1),d=new Array(t.length-1),c=new Array(t.length-1),h=new Array(t.length-1),p=new Array(t.length-1),m=new Array(t.length-1),w=new Array(t.length-1),g=new Array(t.length-1),v=new Array(t.length-1),y=new Array(t.length-1),x=new Array(t.length-1),b=new Array(t.length-1),E=new Array(t.length-1),A=new Array(t.length-1),M=e.year_fraction_factory(null);for(s=0;s<t.length-1;s++)f[s]=t[s],u[s]=t[s+1],l[s]=(_=t[s+1],e.adjust(_,r,a)),h[s]=M(e.valuation_date,l[s]),d[s]=M(e.valuation_date,t[s]),c[s]=M(e.valuation_date,t[s+1]),p[s]=!0,m[s]=!1,w[s]=!1,g[s]=!1,v[s]=i,y[s]=i*o*n(f[s],u[s]),x[s]=y[s],b[s]=0,E[s]=y[s],A[s]=E[s];return this.include_notional_pmt&&(A[t.length-2]+=i,b[t.length-2]+=i),m[t.length-2]=!0,{date_accrual_start:f,date_accrual_end:u,date_pmt:l,t_accrual_start:d,t_accrual_end:c,t_pmt:h,is_interest_date:p,is_repay_date:m,is_fixing_date:w,is_condition_date:g,current_principal:v,interest_current_period:y,accrued_interest:x,pmt_principal:b,pmt_interest:E,pmt_total:A}},e.simple_fixed_income.prototype.get_cash_flows=function(t){if(!this.is_float)return this.cash_flows;var r,a,n,i=this.cash_flows,o=e.year_fraction_factory(null),s=i.t_pmt.length;for(r=0;r<s;r++)i.is_fixing_date[r]=!0,a=i.date_accrual_start[r]<e.valuation_date?this.current_rate:e.get_fwd_rate(t,o(e.valuation_date,i.date_accrual_start[r]),o(e.valuation_date,i.date_accrual_end[r]))+this.float_spread,n=this.notional*a*this.year_fraction_func(i.date_accrual_start[r],i.date_accrual_end[r]),i.interest_current_period[r]=n,i.accrued_interest[r]=n,i.pmt_interest[r]=n;return i.pmt_total[s-1]=i.pmt_interest[s-1]+this.notional,i},e.simple_fixed_income.prototype.present_value=function(t,r,a){return e.dcf(this.get_cash_flows(a||null),t,r,this.residual_spread,this.settlement_date)},e.pricer_bond=function(t,r,a){return new e.simple_fixed_income(t).present_value(r,a,null)},e.pricer_floater=function(t,r,a,n){return new e.simple_fixed_income(t).present_value(r,a,n)},e.pricer_fxterm=function(t,r){var a=new e.simple_fixed_income({notional:t.notional,maturity:t.maturity,fixed_rate:0,tenor:0}).present_value(r,null,null);return"number"!=typeof t.notional_2?a:a+new e.simple_fixed_income({notional:t.notional_2,maturity:t.maturity_2,fixed_rate:0,tenor:0}).present_value(r,null,null)}}(this.JsonRisk||module.exports),function(e){function t(t){var r,a;for(r=surface.labels_expiry.length,a=new Array(r);r>0;)a[--r]=e.period_str_to_time(t[r]);return a}e.get_const_surface=function(e,t){if("number"!=typeof e)throw new Error("get_const_surface: input must be number.");return{type:t||"",expiries:[1],terms:[1],values:[[e]]}},e.get_safe_surface=function(r){var a,n;if(!r)return e.get_const_surface(0);if(r.expiries)a=r.expiries;else{if(!r.labels_expiry)throw new Error("get_initialised_surface: cannot derive expiries");a=t(labels_expiry)}if(r.terms)n=r.terms;else{if(!r.labels_term)throw new Error("get_initialised_surface: cannot derive terms");n=t(labels_term)}if(r.values.length!==a.length)throw new Error("get_initialised_surface: expiries dimensions do not match values array");for(var i=0;i<a.length;i++)if(r.values[i].length!==n.length)throw new Error("get_initialised_surface: terms dimensions do not match values array");return{type:r.type||"",expiries:a,terms:n,values:r.values}},get_slice_rate_unsafe=function(e,t,r,a,n){a=a||0,n=n||e.terms.length-1;var i=e.values[t];return a===n?i[a]:r<e.terms[a]?i[a]:r>e.terms[n]?i[n]:a+1===n?i[a]*(e.terms[n]-r)/(e.terms[n]-e.terms[a])+i[n]*(r-e.terms[a])/(e.terms[n]-e.terms[a]):(imed=Math.ceil((a+n)/2),r>e.terms[imed]?get_slice_rate_unsafe(e,t,r,imed,n):get_slice_rate_unsafe(e,t,r,a,imed))},get_surface_rate_unsafe=function(e,t,r,a,n){return(a=a||0)===(n=n||e.expiries.length-1)?get_slice_rate_unsafe(e,a,r):t<e.expiries[a]?get_slice_rate_unsafe(e,a,r):t>e.expiries[n]?get_slice_rate_unsafe(e,n,r):a+1===n?get_slice_rate_unsafe(e,a,r)*(e.expiries[n]-t)/(e.expiries[n]-e.expiries[a])+get_slice_rate_unsafe(e,n,r)*(t-e.expiries[a])/(e.expiries[n]-e.expiries[a]):(imed=Math.ceil((a+n)/2),t>e.expiries[imed]?get_surface_rate_unsafe(e,t,r,imed,n):get_surface_rate_unsafe(e,t,r,a,imed))},e.get_surface_rate=function(t,r,a){var n=e.get_safe_surface(t);return get_surface_rate_unsafe(n,r,a)}}(this.JsonRisk||module.exports),function(e){e.swap=function(t){this.phi=t.is_payer?-1:1,this.fixed_rate=t.fixed_rate,this.fixed_leg=new e.simple_fixed_income({notional:t.notional*this.phi,maturity:t.maturity,fixed_rate:t.fixed_rate,tenor:t.fixed_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc},!1),this.fixed_leg_1bp=new e.simple_fixed_income({notional:t.notional*this.phi,maturity:t.maturity,fixed_rate:1e-4,tenor:t.fixed_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc},!1),this.float_leg=new e.simple_fixed_income({notional:-t.notional*this.phi,maturity:t.maturity,float_spread:t.float_spread,tenor:t.float_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.float_bdc,dcc:t.float_dcc,current_rate:t.float_current_rate},!1)},e.swap.prototype.present_value=function(e,t){var r=0;return r+=this.fixed_leg.present_value(e,null,null),r+=this.float_leg.present_value(e,null,t)},e.swap.prototype.fair_rate=function(e,t){var r=this.float_leg.present_value(e,null,t);return-this.phi*r/this.annuity(e)},e.swap.prototype.annuity=function(e){return this.fixed_leg_1bp.present_value(e)*this.phi*1e4},e.swap.prototype.present_value=function(e,t){var r=0;return r+=this.fixed_leg.present_value(e,null,null),r+=this.float_leg.present_value(e,null,t)},e.swap.prototype.get_cash_flows=function(e){return{fixed_leg:this.fixed_leg.get_cash_flows(),float_leg:this.float_leg.get_cash_flows(e)}},e.pricer_swap=function(t,r,a){return new e.swap(t).present_value(r,a)}}(this.JsonRisk||module.exports),function(e){e.swaption=function(t){if(this.sign=t.is_short?-1:1,this.maturity=e.get_safe_date(t.maturity),!this.maturity)throw new Error("swaption: must provide valid maturity date.");if(this.expiry=e.get_safe_date(t.expiry),!this.expiry)throw new Error("swaption: must provide valid expiry date.");this.swap=new e.swap(t)},e.swaption.prototype.present_value=function(t,r,a){if(null===e.valuation_date)throw new Error("swaption.present_value: valuation_date must be set");var n=e.year_fraction_factory(null),i=n(e.valuation_date,this.maturity),o=n(e.valuation_date,this.expiry),s=i-o;if(s<1/512)return 0;var _,f=this.swap.fair_rate(t,r),u=e.get_surface_rate(a,o,s)*Math.sqrt(o);if(o<1/512||u<1e-4)_=Math.max(this.swap.phi*(this.swap.fixed_rate-f),0);else{var l=(this.swap.fixed_rate-f)/u;_=this.swap.phi*(this.swap.fixed_rate-f)*e.cndf(this.swap.phi*l)+u*e.ndf(l)}return _*=this.swap.annuity(t),_*=this.sign},e.pricer_swaption=function(t,r,a,n){return new e.swaption(t).present_value(r,a,n)},e.create_equivalent_regular_swaption=function(t,r,a){if(void 0===t.date_pmt||void 0===t.pmt_total||void 0===t.current_principal)throw new Error("create_equivalent_regular_swaption: invalid cashflow object");if(t.t_pmt.length!==t.pmt_total.length||t.t_pmt.length!==t.current_principal.length)throw new Error("create_equivalent_regular_swaption: invalid cashflow object");if(null===e.valuation_date)throw new Error("create_equivalent_swaption: valuation_date must be set");a||(a={});var n,i=a.tenor||6,o=a.bdc||"unadjusted",s=a.calendar||"",_=0;for(n=0;n<t.current_principal.length;n++)t.date_pmt[n]<=r&&(_=t.current_principal[n]);if(0===_)throw new Error("create_equivalent_regular_swaption: invalid cashflow object or expiry, zero outstanding principal");var f=e.irr(t,r,-_);f=12/i*(Math.pow(1+f,i/12)-1);for(var u=e.get_const_curve(f+1e-4),l=e.get_const_curve(f-1e-4),d=e.dcf(t,u,null,null,r),c=e.dcf(t,l,null,null,r),h=1e4*(c-d)/(c+d),p=function(t){var r=new e.simple_fixed_income(t);return d=r.present_value(u),1e4*((c=r.present_value(l))-d)/(c+d)},m=Math.abs(f)<1e-8?h:-Math.log(1-h*f)/f,w=e.add_days(e.valuation_date,Math.round(365*m)),g={maturity:w,effective_date:r,settlement_date:r,notional:_,fixed_rate:f,tenor:i,calendar:s,bdc:o,dcc:"act/365"},v=p(g),y=20;Math.abs(v-h)>1/512&&y>0;)m=m*h/v,w=e.add_days(e.valuation_date,Math.round(365*m)),g.maturity=w,v=p(g),y--;return{is_payer:!1,maturity:w,expiry:r,notional:_,fixed_rate:f,fixed_tenor:i,float_spread:0,float_tenor:6,float_current_rate:0,calendar:s,fixed_bdc:o,float_bdc:o,fixed_dcc:"act/365",float_dcc:"act/365"}}}(this.JsonRisk||module.exports),function(e){var t=1/864e5;function r(e){return e%4==0&&(2e3===e||e%100!=0)}function a(e,t){return 1===t?r(e)?29:28:3===t||5===t||8===t||10===t?30:31}function n(e,r){return Math.round((r-e)*t)}function i(e,t){return n(e,t)/365}function o(e,t){return n(e,t)/360}function s(e,t){return(360*(t.getFullYear()-e.getFullYear())+30*(t.getMonth()-e.getMonth())+(Math.min(t.getDate(),30)-Math.min(e.getDate(),30)))/360}function _(e,t){if(e-t==0)return 0;if(e>t)return-_(t,e);var a=e.getFullYear(),i=t.getFullYear();if(a===i)return n(t,e)/(r(a)?366:365);var o=i-a-1;return o+=n(e,new Date(a+1,0,1))/(r(a)?366:365),o+=n(new Date(i,0,1),t)/(r(i)?366:365)}function f(e){return wd=e.getDay(),0===wd||6===wd}function u(t){if(f(t))return!0;var r=t.getDate(),a=t.getMonth();if(1===r&&0===a)return!0;if(25===r&&11===a)return!0;var n=t.getFullYear();if((1998===n||1999===n||2001===n)&&31===r&&11===a)return!0;if(n>2e3){if(1===r&&4===a||26===r&&11===a)return!0;var i=function(e){var t=Math.floor,r=t(e/100),a=e-19*t(e/19),n=t((r-17)/25),i=r-t(r/4)-t((r-n)/3)+19*a+15;i-=30*t(i/30),i-=t(i/28)*(1-t(i/28)*t(29/(i+1))*t((21-a)/11));var o=e+t(e/4)+i+2-r+t(r/4),s=i-(o-=7*t(o/7)),_=3+t((s+40)/44),f=s+28-31*t(_/4);return new Date(e,_-1,f)}(n);if(t.getTime()===e.add_days(i,-2).getTime())return!0;if(t.getTime()===e.add_days(i,1).getTime())return!0}return!1}e.period_str_to_time=function(e){var t=parseInt(e,10),r=e.charAt(e.length-1);if("Y"===r||"y"===r)return t;if("M"===r||"m"===r)return t/12;if("W"===r||"w"===r)return t/52;if("D"===r||"d"===r)return t/365;throw new Error("period_str_to_time(str) - Invalid time period string: "+e)},e.date_str_to_date=function(e){var t,r,n,i=null;if(null!==(i=/^([1-2][0-9]{3})[\/-]([0-9]{1,2})[\/-]([0-9]{1,2})/.exec(e))?(n=parseInt(i[1],10),r=parseInt(i[2],10)-1,t=parseInt(i[3],10)):null!==(i=/^([0-9]{1,2})\.([0-9]{1,2})\.([1-2][0-9]{3})/.exec(e))&&(n=parseInt(i[3],10),r=parseInt(i[2],10)-1,t=parseInt(i[1],10)),null===i)throw new Error("date_str_to_time(str) - Invalid date string: "+e);if(r<0||r>11)throw new Error("date_str_to_time(str) - Invalid month in date string: "+e);if(t<0||t>a(n,r))throw new Error("date_str_to_time(str) - Invalid day in date string: "+e);return new Date(n,r,t)},e.get_safe_date=function(t){if(!t)return null;if(t instanceof Date)return t;if(t instanceof String||"string"==typeof t)return e.date_str_to_date(t);throw new Error("get_safe_date: invalid input.")},e.year_fraction_factory=function(e){if(!(e instanceof String)&&"string"!=typeof e)return i;var t=e.toLowerCase();if("a"===t.charAt(0)){if("actual/365"===t||"act/365"===t||"a/365"===t||"act/365 (fixed)"===t||"actual/365 (fixed)"===t)return i;if("act/360"===t||"a/360"===t)return o;if("act/act"===t||"a/a"===t)return _}return"3"===t.charAt(0)&&"30e/360"===t?s:i},e.add_days=function(e,t){var r=new Date(e.valueOf());return r.setDate(r.getDate()+t),r},e.add_months=function(e,t,r){for(y=e.getFullYear(),m=e.getMonth()+t;m>=12;)m-=12,y+=1;for(;m<0;)m+=12,y-=1;return d=void 0===r?e.getDate():r,new Date(y,m,Math.min(d,a(y,m)))};var l={};e.add_calendar=function(r,a){if(!(r instanceof String||"string"==typeof r))throw new Error("add_calendar: invalid input.");if(!Array.isArray(a))throw new Error("add_calendar: invalid input.");var n,i,o,s=a.length,_=[];for(n=0;n<s;n++)(o=e.get_safe_date(a[n]))&&(f(o)||_.push(o));for(s=_.length,n=1;n<41&&!((i=n*n-n+41)>=s/10);)n++;var u=new Array(i);for(n=0;n<i;n++)u[n]=[];for(n=0;n<s;n++)u[Math.floor(_[n].getTime()*t)%i].push(_[n].getTime());return l[r.toLowerCase()]=u,i},e.is_holiday_factory=function(e){var r=e.toLowerCase();if("target"===r)return u;if(Array.isArray(l[r])){var a=l[r];return function(e){if(f(e))return!0;for(var r=e.getTime(),n=Math.floor(r*t)%a.length,i=0;i<a[n].length;i++)if(r===a[n][i])return!0;return!1}}return f},e.adjust=function(t,r,a){var n,i=(r||"u").charAt(0).toLowerCase(),o=new Date(t);if("u"===i)return o;if("m"===i&&(n=o.getMonth()),"m"===i||"f"===i)for(;a(o);)o=e.add_days(o,1);if("f"===i)return o;if("m"===i&&n===o.getMonth())return o;for("m"===i&&(o=e.add_days(o,-1));a(o);)o=e.add_days(o,-1);return o}}(this.JsonRisk||module.exports);