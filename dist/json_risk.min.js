/*! json_risk 08-02-2019 */

!function(e,t){"object"==typeof module&&"undefined"!=typeof exports?module.exports=t():e.JsonRisk=t()}(this,function(){var e={valuation_date:null,pricer:function(e,t){return null}};return e}),function(e){e.get_const_curve=function(e){if("number"!=typeof e)throw new Error("get_const_curve: input must be number.");if(e<=-1)throw new Error("get_const_curve: invalid input.");return{type:"yield",times:[1],dfs:[1/(1+e)]}},e.get_initialised_curve=function(t){if(!t)return e.get_const_curve(0);var r,i=function(t){var r,i;if(void 0===t.times){if(void 0!==t.days)for(r=t.days.length,i=new Array(r);r>0;)i[--r]=t.days[r]/365;else if(void 0!==t.dates){r=t.dates.length,i=new Array(r);for(var n=e.year_fraction_factory("act/365"),a=e.date_str_to_date(t.dates[0]);r>0;)i[--r]=n(a,e.date_str_to_date(t.dates[r]))}else{if(void 0===t.labels)throw new Error("init_curve: invalid curve, cannot derive times");for(r=t.labels.length,i=new Array(r);r>0;)i[--r]=e.period_str_to_time(t.labels[r])}return i}for(r=t.times.length;r>0;)if(r--,"number"!=typeof t.times[r])throw new Error("get_curve_times: invalid vector of times, must be numeric");return t.times}(t);if(void 0!==t.dfs)r=t.dfs;else{if(void 0===t.zcs)throw new Error("get_initialised_curve: invalid curve, both dfs and zcs undefined");r=function(e,t){var r,i;if(r=e.length,t.length!==r)throw new Error("get_dfs: invalid input, length of zcs does not match length of times");for(i=new Array(r);r>0;){if("number"!=typeof e[--r])throw new Error("get_curve_times: invalid vector of times, must be numeric");i[r]=Math.pow(1+e[r],-t[r])}return i}(t.zcs,i)}return{type:"yield",times:i,dfs:r}},get_df_internal=function(e,t,r,i){if(t<1/512)return 1;if(r===i)return t===e.times[r]?e.dfs[r]:Math.pow(e.dfs[r],t/e.times[r]);if(t<e.times[r])return Math.pow(e.dfs[r],t/e.times[r]);if(t>e.times[i])return Math.pow(e.dfs[i],t/e.times[i]);if(r+1===i){if(e.times[i]-e.times[r]<1/512)throw new Error("get_df_internal: invalid curve, support points must be increasing and differ at least one day");return e.dfs[r]*(e.times[i]-t)/(e.times[i]-e.times[r])+e.dfs[i]*(t-e.times[r])/(e.times[i]-e.times[r])}return imed=Math.ceil((r+i)/2),t>e.times[imed]?get_df_internal(e,t,imed,i):get_df_internal(e,t,r,imed)},e.get_df=function(t,r){var i=e.get_initialised_curve(t);return get_df_internal(i,r,0,i.times.length-1)},e.get_rate=function(t,r){return r<1/512?0:Math.pow(e.get_df(t,r),-1/r)-1},e.get_fwd_rate=function(t,r,i){if(i-r<1/512)return 0;var n=e.get_initialised_curve(t);return Math.pow(e.get_df(n,i)/e.get_df(n,r),-1/(i-r))-1}}(this.JsonRisk||module.exports),function(e){e.irregular_fixed_income=function(t){var r=e.get_initialised_date(t.maturity);if(!r)throw new Error("irregular_fixed_income: must provide maturity date.");if("number"!=typeof t.notional)throw new Error("irregular_fixed_income: must provide valid notional.");if(this.notional=t.notional,"number"!=typeof t.tenor)throw new Error("irregular_fixed_income: must provide valid tenor.");if(t.tenor<0||t.tenor!==Math.floor(t.tenor))throw new Error("irregular_fixed_income: must provide valid tenor.");var i=t.tenor;this.type="string"==typeof t.type?t.type:"unknown",this.is_holiday_func=e.is_holiday_factory(t.calendar||""),this.year_fraction_func=e.year_fraction_factory(t.dcc||""),this.bdc=t.bdc||"";var n=e.get_initialised_date(t.effective_date),a=e.get_initialised_date(t.first_date),o=e.get_initialised_date(t.next_to_last_date),s="number"==typeof t.settlement_days?t.settlement_days:0;this.settlement_date=e.adjust(e.add_days(e.valuation_date,s),"following",this.is_holiday_func);"number"==typeof t.residual_spread&&t.residual_spread,t.currency;if("number"==typeof t.fixed_rate)this.is_float=!1,this.fixed_rate=t.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof t.float_spread?t.float_spread:0,"number"!=typeof t.current_rate)throw new Error("irregular_fixed_income: must provide valid current_rate.");this.current_rate=t.current_rate}this.schedule=e.backward_schedule(n,r,i,this.is_holiday_func,this.bdc,a,o),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},e.irregular_fixed_income.prototype.fix_cash_flows=function(t,r,i,n,a,o){if(null===e.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var s,_,f=new Array(t.length-1),d=new Array(t.length-1),l=new Array(t.length-1),u=new Array(t.length-1),c=new Array(t.length-1),h=new Array(t.length-1),m=new Array(t.length-1),p=new Array(t.length-1),g=new Array(t.length-1),w=new Array(t.length-1),y=new Array(t.length-1),v=new Array(t.length-1),x=new Array(t.length-1),b=new Array(t.length-1),A=new Array(t.length-1),E=new Array(t.length-1),M=e.year_fraction_factory(null);for(s=0;s<t.length-1;s++)f[s]=t[s],d[s]=t[s+1],l[s]=(_=t[s+1],e.adjust(_,r,i)),h[s]=M(e.valuation_date,t[s+1]),m[s]=!0,p[s]=!1,g[s]=!1,w[s]=!1,y[s]=a,v[s]=a*o*n(f[s],d[s]),x[s]=v[s],b[s]=0,A[s]=v[s],E[s]=A[s];return E[t.length-2]+=a,b[t.length-2]+=a,p[t.length-2]=!0,{date_accrual_start:f,date_accrual_end:d,date_pmt:l,t_accrual_start:u,t_accrual_end:c,t_pmt:h,is_interest_date:m,is_repay_date:p,is_fixing_date:g,is_condition_date:w,current_principal:y,interest_current_period:v,accrued_interest:x,pmt_principal:b,pmt_interest:A,pmt_total:E}},e.irregular_fixed_income.prototype.get_cash_flows=function(t){if(!this.is_float)return this.cash_flows;var r,i,n,a=this.cash_flows,o=e.year_fraction_factory(null),s=a.t_pmt.length;for(r=1;r<s;r++)a.is_fixing_date[r]=!0,i=e.get_fwd_rate(t,o(e.valuation_date,a.date_accrual_start[r]),o(e.valuation_date,a.date_accrual_end[r]))+this.float_spread,n=this.notional*i*this.year_fraction_func(a.date_accrual_start[r],a.date_accrual_end[r]),a.interest_current_period[r]=n,a.accrued_interest[r]=n,a.pmt_interest[r]=n;return a.pmt_total[s-1]=a.pmt_interest[s-1]+this.notional,a},e.irregular_fixed_income.prototype.present_value=function(t,r,i){return e.dcf(this.get_cash_flows(i||null),t,r,this.residual_spread,this.settlement_date)},e.pricer_loan=function(t,r,i,n){return new e.irregular_fixed_income(t).present_value(r,i,n)}}(this.JsonRisk||module.exports),function(e){var t=Math.sqrt(4*Math.acos(0));e.ndf=function(e){return Math.exp(-e*e/2)/t},e.cndf=function(e){var r=Math.abs(e),i=0;if(r<=37){var n=Math.exp(-r*r/2);if(r<7.07106781186547)i=n*((((((.0352624965998911*r+.700383064443688)*r+6.37396220353165)*r+33.912866078383)*r+112.079291497871)*r+221.213596169931)*r+220.206867912376)/(((((((.0883883476483184*r+1.75566716318264)*r+16.064177579207)*r+86.7807322029461)*r+296.564248779674)*r+637.333633378831)*r+793.826512519948)*r+440.413735824752);else i=n/(t*(r+1/(r+2/(r+3/(r+4/(r+.65))))))}return e<=0?i:1-i}}(this.JsonRisk||module.exports),function(e){e.backward_schedule=function(t,r,i,n,a,o,s){if(!(r instanceof Date))throw new Error("backward_schedule: maturity must be provided");if(!(t instanceof Date)){if(null===e.valuation_date)throw new Error("backward_schedule: if valuation_date is unset, effective date must be provided");if(o instanceof Date)throw new Error("backward_schedule: if first date is provided, effective date must be provided")}if(t instanceof Date&&r<t||e.valuation_date instanceof Date&&r<e.valuation_date)throw new Error("backward_schedule: maturity is before valution or effective date.");if("number"!=typeof i)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(i<0||Math.floor(i)!==i)throw new Error("backward_schedule: tenor must be a nonnegative integer, e.g., 6 for semiannual schedule, 0 for zerobond/iam schedule");if(0===i)return[t,r];var _=function(t){return e.adjust(t,a,n)},f=[r],d=r;s instanceof Date&&_(s)<_(r)&&(f.unshift(s),d=s);for(var l,u=0;;){if(u++,l=e.add_months(d,-i*u),o instanceof Date&&l<o)return _(f[0]).getTime()!==_(o).getTime()&&f.unshift(o),_(f[0]).getTime()!==_(t).getTime()&&f.unshift(t),f;if(t instanceof Date&&l<t)return _(f[0]).getTime()!==_(t).getTime()&&f.unshift(t),f;if(e.valuation_date instanceof Date&&l<e.valuation_date)return f.unshift(l),_(l)>e.valuation_date&&(u++,l=e.add_months(d,-i*u),o instanceof Date&&l<o?f.unshift(o):t instanceof Date&&l<t?f.unshift(t):f.unshift(l)),f;f.unshift(l)}}}(this.JsonRisk||module.exports),function(e){e.dcf=function(t,r,i,n,a){if(null===e.valuation_date)throw new Error("dcf: valuation_date must be set");var o=e.get_initialised_curve(r),s=e.get_initialised_curve(i);"number"!=typeof n&&(n=0);var _=e.get_initialised_date(a);if(_||(_=e.valuation_date),void 0===t.t_pmt||void 0===t.pmt_total)throw new Error("dcf: invalid cashflow object");if(t.t_pmt.length!==t.pmt_total.length)throw new Error("dcf: invalid cashflow object");for(var f,d,l,u=0,c=0;t.date_pmt[c]<=_;)c++;for(;c<t.t_pmt.length;)f=e.get_df(o,t.t_pmt[c]),d=e.get_df(s,t.t_pmt[c]),l=Math.exp(-t.t_pmt[c]*n),u+=t.pmt_total[c]*f*d*l,c++;return u},e.simple_fixed_income=function(t){var r=e.get_initialised_date(t.maturity);if(!r)throw new Error("simple_fixed_income: must provide maturity date.");if("number"!=typeof t.notional)throw new Error("simple_fixed_income: must provide valid notional.");if(this.notional=t.notional,"number"!=typeof t.tenor)throw new Error("simple_fixed_income: must provide valid tenor.");if(t.tenor<0||t.tenor!==Math.floor(t.tenor))throw new Error("simple_fixed_income: must provide valid tenor.");var i=t.tenor;this.type="string"==typeof t.type?t.type:"unknown",this.is_holiday_func=e.is_holiday_factory(t.calendar||""),this.year_fraction_func=e.year_fraction_factory(t.dcc||""),this.bdc=t.bdc||"";var n=e.get_initialised_date(t.effective_date),a=e.get_initialised_date(t.first_date),o=e.get_initialised_date(t.next_to_last_date),s="number"==typeof t.settlement_days?t.settlement_days:0;this.settlement_date=e.adjust(e.add_days(e.valuation_date,s),"following",this.is_holiday_func);"number"==typeof t.residual_spread&&t.residual_spread,t.currency;if("number"==typeof t.fixed_rate)this.is_float=!1,this.fixed_rate=t.fixed_rate;else{if(this.is_float=!0,this.float_spread="number"==typeof t.float_spread?t.float_spread:0,"number"!=typeof t.current_rate)throw new Error("simple_fixed_income: must provide valid current_rate.");this.current_rate=t.current_rate}this.schedule=e.backward_schedule(n,r,i,this.is_holiday_func,this.bdc,a,o),this.cash_flows=this.fix_cash_flows(this.schedule,this.bdc,this.is_holiday_func,this.year_fraction_func,this.notional,this.is_float?this.current_rate:this.fixed_rate)},e.simple_fixed_income.prototype.fix_cash_flows=function(t,r,i,n,a,o){if(null===e.valuation_date)throw new Error("fix_cash_flows: valuation_date must be set");var s,_,f=new Array(t.length-1),d=new Array(t.length-1),l=new Array(t.length-1),u=new Array(t.length-1),c=new Array(t.length-1),h=new Array(t.length-1),m=new Array(t.length-1),p=new Array(t.length-1),g=new Array(t.length-1),w=new Array(t.length-1),y=new Array(t.length-1),v=new Array(t.length-1),x=new Array(t.length-1),b=new Array(t.length-1),A=new Array(t.length-1),E=new Array(t.length-1),M=e.year_fraction_factory(null);for(s=0;s<t.length-1;s++)f[s]=t[s],d[s]=t[s+1],l[s]=(_=t[s+1],e.adjust(_,r,i)),h[s]=M(e.valuation_date,t[s+1]),m[s]=!0,p[s]=!1,g[s]=!1,w[s]=!1,y[s]=a,v[s]=a*o*n(f[s],d[s]),x[s]=v[s],b[s]=0,A[s]=v[s],E[s]=A[s];return E[t.length-2]+=a,b[t.length-2]+=a,p[t.length-2]=!0,{date_accrual_start:f,date_accrual_end:d,date_pmt:l,t_accrual_start:u,t_accrual_end:c,t_pmt:h,is_interest_date:m,is_repay_date:p,is_fixing_date:g,is_condition_date:w,current_principal:y,interest_current_period:v,accrued_interest:x,pmt_principal:b,pmt_interest:A,pmt_total:E}},e.simple_fixed_income.prototype.get_cash_flows=function(t){if(!this.is_float)return this.cash_flows;var r,i,n,a=this.cash_flows,o=e.year_fraction_factory(null),s=a.t_pmt.length;for(r=1;r<s;r++)a.is_fixing_date[r]=!0,i=e.get_fwd_rate(t,o(e.valuation_date,a.date_accrual_start[r]),o(e.valuation_date,a.date_accrual_end[r]))+this.float_spread,n=this.notional*i*this.year_fraction_func(a.date_accrual_start[r],a.date_accrual_end[r]),a.interest_current_period[r]=n,a.accrued_interest[r]=n,a.pmt_interest[r]=n;return a.pmt_total[s-1]=a.pmt_interest[s-1]+this.notional,a},e.simple_fixed_income.prototype.present_value=function(t,r,i){return e.dcf(this.get_cash_flows(i||null),t,r,this.residual_spread,this.settlement_date)},e.pricer_bond=function(t,r,i){return new e.simple_fixed_income(t).present_value(r,i,null)},e.pricer_floater=function(t,r,i,n){return new e.simple_fixed_income(t).present_value(r,i,n)},e.pricer_swap=function(t,r,i){var n=t.is_payer?-1:1,a=new e.simple_fixed_income({notional:t.notional*n,maturity:t.maturity,fixed_rate:t.fixed_rate,tenor:t.fixed_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc}),o=new e.simple_fixed_income({notional:-t.notional*n,maturity:t.maturity,float_spread:t.float_spread,tenor:t.float_tenor,effective_date:t.effective_date,calendar:t.calendar,bdc:t.float_bdc,dcc:t.float_dcc,current_rate:t.float_current_rate});return a.present_value(r,null,null)+o.present_value(r,null,i)},e.pricer_fxterm=function(t,r){var i=new e.simple_fixed_income({notional:t.notional,maturity:t.maturity,fixed_rate:0,tenor:0}).present_value(r,null,null);return"number"!=typeof t.notional_2?i:i+new e.simple_fixed_income({notional:t.notional_2,maturity:t.maturity_2,fixed_rate:0,tenor:0}).present_value(r,null,null)}}(this.JsonRisk||module.exports),function(e){function t(t){var r,i;for(r=surface.labels_expiry.length,i=new Array(r);r>0;)i[--r]=e.period_str_to_time(t[r]);return i}e.get_const_surface=function(e,t){if("number"!=typeof e)throw new Error("get_const_surface: input must be number.");return{type:t||"",expiries:[1],terms:[1],values:[[e]]}},e.get_safe_surface=function(r){var i,n;if(!r)return e.get_const_surface(0);if(r.expiries)i=r.expiries;else{if(!r.labels_expiry)throw new Error("get_initialised_surface: cannot derive expiries");i=t(labels_expiry)}if(r.terms)n=r.terms;else{if(!r.labels_term)throw new Error("get_initialised_surface: cannot derive terms");n=t(labels_term)}if(r.values.length!==i.length)throw new Error("get_initialised_surface: expiries dimensions do not match values array");for(var a=0;a<i.length;a++)if(r.values[a].length!==n.length)throw new Error("get_initialised_surface: terms dimensions do not match values array");return{type:r.type||"",expiries:i,terms:n,values:r.values}},get_slice_rate_unsafe=function(e,t,r,i,n){i=i||0,n=n||e.terms.length-1;var a=e.values[t];return i===n?a[i]:r<e.terms[i]?a[i]:r>e.terms[n]?a[n]:i+1===n?a[i]*(e.terms[n]-r)/(e.terms[n]-e.terms[i])+a[n]*(r-e.terms[i])/(e.terms[n]-e.terms[i]):(imed=Math.ceil((i+n)/2),r>e.terms[imed]?get_slice_rate_unsafe(e,t,r,imed,n):get_slice_rate_unsafe(e,t,r,i,imed))},get_surface_rate_unsafe=function(e,t,r,i,n){return(i=i||0)===(n=n||e.expiries.length-1)?get_slice_rate_unsafe(e,i,r):t<e.expiries[i]?get_slice_rate_unsafe(e,i,r):t>e.expiries[n]?get_slice_rate_unsafe(e,n,r):i+1===n?get_slice_rate_unsafe(e,i,r)*(e.expiries[n]-t)/(e.expiries[n]-e.expiries[i])+get_slice_rate_unsafe(e,n,r)*(t-e.expiries[i])/(e.expiries[n]-e.expiries[i]):(imed=Math.ceil((i+n)/2),t>e.expiries[imed]?get_surface_rate_unsafe(e,t,r,imed,n):get_surface_rate_unsafe(e,t,r,i,imed))},e.get_surface_rate=function(t,r,i){var n=e.get_safe_surface(t);return get_surface_rate_unsafe(n,r,i)}}(this.JsonRisk||module.exports),function(e){e.swaption=function(t){if(this.phi=t.is_payer?-1:1,this.sign=t.is_short?-1:1,this.maturity=e.get_initialised_date(t.maturity),!this.maturity)throw new Error("swaption: must provide valid maturity date.");if(this.swap_fixed_leg=new e.simple_fixed_income({notional:t.notional,maturity:t.maturity,fixed_rate:t.fixed_rate,tenor:t.fixed_tenor,effective_date:t.expiry,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc}),this.swap_fixed_leg_1bp=new e.simple_fixed_income({notional:t.notional,maturity:t.maturity,fixed_rate:1e-4,tenor:t.fixed_tenor,effective_date:t.expiry,calendar:t.calendar,bdc:t.fixed_bdc,dcc:t.fixed_dcc}),this.swap_float_leg=new e.simple_fixed_income({notional:-t.notional,maturity:t.maturity,float_spread:t.float_spread,tenor:t.float_tenor,effective_date:t.expiry,calendar:t.calendar,bdc:t.float_bdc,dcc:t.float_dcc,current_rate:t.float_current_rate}),this.expiry=e.get_initialised_date(t.expiry),!this.expiry)throw new Error("swaption: must provide valid expiry date.")},e.swaption.prototype.present_value=function(t,r,i){if(null===e.valuation_date)throw new Error("swaption.present_value: valuation_date must be set");var n=e.year_fraction_factory(null),a=n(e.valuation_date,this.maturity),o=n(e.valuation_date,this.expiry),s=a-o;if(s<1/512)return 0;var _,f=e.get_df(t,a)*this.swap_fixed_leg.notional,d=this.swap_float_leg.present_value(t,null,r)+f,l=(this.swap_fixed_leg.present_value(t,null,null),(this.swap_fixed_leg_1bp.present_value(t,null,null)-f)/1e-4),u=-d/l,c=e.get_surface_rate(i,o,s)*Math.sqrt(o);if(o<1/512||c<1e-4)_=Math.max(this.phi*(this.swap_fixed_leg.fixed_rate-u),0);else{var h=(this.swap_fixed_leg.fixed_rate-u)/c;_=this.phi*(this.swap_fixed_leg.fixed_rate-u)*e.cndf(this.phi*h)+c*e.ndf(h)}return _*=l,_*=this.sign},e.pricer_swaption=function(t,r,i,n){return new e.swaption(t).present_value(r,i,n)}}(this.JsonRisk||module.exports),function(e){var t=1/864e5;function r(e){return e%4==0&&(2e3===e||e%100!=0)}function i(e,t){return 1===t?r(e)?29:28:3===t||5===t||8===t||10===t?30:31}function n(e,r){return(r-e)*t}function a(e,t){return n(e,t)/365}function o(e,t){return n(e,t)/360}function s(e,t){return(360*(t.getFullYear()-e.getFullYear())+30*(t.getMonth()-e.getMonth())+(Math.min(t.getDate(),30)-Math.min(e.getDate(),30)))/360}function _(e,t){if(e-t==0)return 0;if(e>t)return-_(t,e);var i=e.getFullYear(),a=t.getFullYear();if(i===a)return n(t,e)/(r(i)?366:365);var o=a-i-1;return o+=n(e,new Date(i+1,0,1))/(r(i)?366:365),o+=n(new Date(a,0,1),t)/(r(a)?366:365)}function f(e){return wd=e.getDay(),0===wd||6===wd}function l(t){var r=t.getDay();if(0===r)return!0;if(6===r)return!0;var i=t.getDate(),n=t.getMonth();if(1===i&&0===n)return!0;if(25===i&&11===n)return!0;var a=t.getFullYear();if((1998===a||1999===a||2001===a)&&31===i&&11===n)return!0;if(a>2e3){if(1===i&&4===n||26===i&&11===n)return!0;var o=function(e){var t=Math.floor,r=t(e/100),i=e-19*t(e/19),n=t((r-17)/25),a=r-t(r/4)-t((r-n)/3)+19*i+15;a-=30*t(a/30),a-=t(a/28)*(1-t(a/28)*t(29/(a+1))*t((21-i)/11));var o=e+t(e/4)+a+2-r+t(r/4),s=a-(o-=7*t(o/7)),_=3+t((s+40)/44),f=s+28-31*t(_/4);return new Date(e,_-1,f)}(a);if(t.getTime()===e.add_days(o,-2).getTime())return!0;if(t.getTime()===e.add_days(o,1).getTime())return!0}return!1}e.period_str_to_time=function(e){var t=parseInt(e,10),r=e.charAt(e.length-1);if("Y"===r||"y"===r)return t;if("M"===r||"m"===r)return t/12;if("W"===r||"w"===r)return t/52;if("D"===r||"d"===r)return t/365;throw new Error("period_str_to_time(str) - Invalid time period string: "+e)},e.date_str_to_date=function(e){var t,r,n,a=null;if(null!==(a=/^([1-2][0-9]{3})[\/-]([0-9]{1,2})[\/-]([0-9]{1,2})/.exec(e))?(n=parseInt(a[1],10),r=parseInt(a[2],10)-1,t=parseInt(a[3],10)):null!==(a=/^([0-9]{1,2})\.([0-9]{1,2})\.([1-2][0-9]{3})/.exec(e))&&(n=parseInt(a[3],10),r=parseInt(a[2],10)-1,t=parseInt(a[1],10)),null===a)throw new Error("date_str_to_time(str) - Invalid date string: "+e);if(r<0||r>11)throw new Error("date_str_to_time(str) - Invalid month in date string: "+e);if(t<0||t>i(n,r))throw new Error("date_str_to_time(str) - Invalid day in date string: "+e);return new Date(n,r,t)},e.get_initialised_date=function(t){if(!t)return null;if(t instanceof Date)return t;if(t instanceof String||"string"==typeof t)return e.date_str_to_date(t);throw new Error("get_initialised_date: invalid input.")},e.year_fraction_factory=function(e){if(!(e instanceof String)&&"string"!=typeof e)return a;var t=e.toLowerCase();if("a"===t.charAt(0)){if("actual/365"===t||"act/365"===t||"a/365"===t||"act/365 (fixed)"===t||"actual/365 (fixed)"===t)return a;if("act/360"===t||"a/360"===t)return o;if("act/act"===t||"a/a"===t)return _}return"3"===t.charAt(0)&&"30e/360"===t?s:a},e.add_days=function(e,t){return new Date(e.valueOf()+864e5*t)},e.add_months=function(e,t,r){for(y=e.getFullYear(),m=e.getMonth()+t;m>=12;)m-=12,y+=1;for(;m<0;)m+=12,y-=1;return d=void 0===r?e.getDate():r,new Date(y,m,Math.min(d,i(y,m)))};var u={};e.add_calendar=function(r,i){if(!(r instanceof String||"string"==typeof r))throw new Error("add_calendar: invalid input.");if(!Array.isArray(i))throw new Error("add_calendar: invalid input.");var n,a,o,s=i.length,_=[];for(n=0;n<s;n++)(o=e.get_initialised_date(i[n]))&&(f(o)||_.push(o));for(s=_.length,n=1;n<41&&!((a=n*n-n+41)>=s/10);)n++;var d=new Array(a);for(n=0;n<a;n++)d[n]=[];for(n=0;n<s;n++)d[Math.floor(_[n].getTime()*t)%a].push(_[n].getTime());return u[r.toLowerCase()]=d,a},e.is_holiday_factory=function(e){var r=e.toLowerCase();if("target"===r)return l;if(Array.isArray(u[r])){var i=u[r];return function(e){if(f(e))return!0;for(var r=e.getTime(),n=Math.floor(r*t)%i.length,a=0;a<i[n].length;a++)if(r===i[n][a])return!0;return!1}}return f},e.adjust=function(t,r,i){var n,a=(r||"u").charAt(0).toLowerCase(),o=new Date(t);if("u"===a)return o;if("m"===a&&(n=o.getMonth()),"m"===a||"f"===a)for(;i(o);)o=e.add_days(o,1);if("f"===a)return o;if("m"===a&&n===o.getMonth())return o;for("m"===a&&(o=e.add_days(o,-1));i(o);)o=e.add_days(o,-1);return o}}(this.JsonRisk||module.exports);